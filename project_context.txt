PROJECT STRUCTURE:
eslint.config.js
gem_instructions.md
GEM_RULES.md
package.json
README.md
src\CakeReactCore.js
src\Components\Form\FormHelper.jsx
src\Components\Form\index.js
src\Components\index.js
src\Components\Templates\Admin\AdminCrudPage.jsx
src\Components\Templates\Admin\AdminUI.jsx
src\Components\Templates\Admin\index.js
src\Components\Templates\index.js
src\Components\Templates\Shared\CakeNotFound.jsx
src\Components\Templates\Shared\index.js
src\Components\UI\CakeImage.jsx
src\Components\UI\index.js
src\Controller\index.js
src\Controller\useController.js
src\index.js
src\Model\Adapters\BaseAdapter.js
src\Model\Adapters\index.js
src\Model\Adapters\SupabaseAdapter.js
src\Model\BaseEntity.js
src\Model\BaseModel.js
src\Model\Behaviors\index.js
src\Model\Behaviors\UploadImageBehavior.js
src\Model\index.js
src\Model\Validation\index.js
src\Model\Validation\ValidationRules.js
src\Model\Validation\Validator.js
src\Storage\BaseStorageAdapter.js
src\Storage\index.js
src\Storage\SupabaseStorageAdapter.js
src\Utils\definePlugin.js
src\Utils\ImageOptimizer.js
src\Utils\index.js
tests\ai_guardrails\BaseEntity.integrity.test.js
tests\ai_guardrails\BaseModel.integrity.test.js
tests\ai_guardrails\SupabaseAdapter.integrity.test.js
tests\integration\BaseModelSupabaseAdapter.test.js
tests\mocks\MockSupabase.js
tests\unit\BaseEntity.test.js
TRIBUTE.md


--- FILE START: eslint.config.js ---
import js from "@eslint/js";
import globals from "globals";
import pluginReact from "eslint-plugin-react";
import { defineConfig } from "eslint/config";

export default defineConfig([
  {
    files: ["**/*.{js,mjs,cjs,jsx}"], plugins: { js }, extends: ["js/recommended"], languageOptions: { globals: globals.browser }, "rules": {
      "react/react-in-jsx-scope": "off"
    }
  },
  pluginReact.configs.flat.recommended,
]);

--- FILE END: eslint.config.js ---

--- FILE START: gem_instructions.md ---
–û—Ç–ª–∏—á–Ω–æ, –¥–∞–≤–∞–π –æ—Ñ–æ—Ä–º–∏–º —ç—Ç–æ –∫–∞–∫ **–ø–æ–ª–Ω–æ–µ, –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∏ —É–¥–æ–±–Ω–æ–µ –¢–ó –Ω–∞ —Ä—É—Å—Å–∫–æ–º** –¥–ª—è —Ç–≤–æ–µ–≥–æ gem‚Äô–∞ *CakeReact Docs & Images* ‚Äî –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Å–∞–π—Ç—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (—Ç—ã —Å–¥–µ–ª–∞–µ—à—å –¥–ª—è —ç—Ç–æ–≥–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç). –ù–∏–∂–µ –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–ø–∏–ø–∞—Å—Ç–∞ üëá

---

# CakeReact Docs & Images üç∞üñºÔ∏èüìö

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–π –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ CakeReact**

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–º–æ—â–∏ –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ **–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π, –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π –∏ –≤–∏–∑—É–∞–ª—å–Ω–æ –≤—ã—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** –¥–ª—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ **CakeReact** –∏ –≤—Å–µ–π –µ–≥–æ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã (`@cakereact/*`).

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:

* –ø–æ–Ω—è—Ç–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º,
* —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π,
* –≤–∏–∑—É–∞–ª—å–Ω–æ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ–π,
* —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Ç—ë–ø–ª–æ–π –∏ –∑–∞–ø–æ–º–∏–Ω–∞—é—â–µ–π—Å—è,
* –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π –≤ –µ–¥–∏–Ω–æ–º —Å—Ç–∏–ª–µ, –≤–¥–æ—Ö–Ω–æ–≤–ª—ë–Ω–Ω–æ–º CakePHP + React.

---

## üßÅ –í–∏–∑—É–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å –∏ –∞–π–¥–µ–Ω—Ç–∏–∫–∞

### –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å—Ç–∏–ª—é –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–π

* üé® **–°—Ç–∏–ª—å**: –º—É–ª—å—Ç—è—à–Ω—ã–π, –∏–ª–ª—é—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π
* üåà **–¶–≤–µ—Ç–∞**: –º—è–≥–∫–∏–µ, –ø–∞—Å—Ç–µ–ª—å–Ω—ã–µ, —Ç—ë–ø–ª—ã–µ
* üßÅ **–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ**: –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–µ, ¬´—É—é—Ç–Ω–æ–µ¬ª, —Ç–≤–æ—Ä—á–µ—Å–∫–æ–µ
* üï∞Ô∏è **–í–∞–π–±**: —Ä–µ—Ç—Ä–æ 60-—Ö (–≤ –¥—É—Ö–µ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ—Ç–∏–ø–æ–≤ CakePHP)
* ‚ú® –î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ª—ë–≥–∫–∏–π ¬´–º–∞–≥–∏—á–µ—Å–∫–∏–π¬ª –æ—Ç—Ç–µ–Ω–æ–∫ (—Å–≤–µ—á–µ–Ω–∏–µ, –∏—Å–∫—Ä—ã, —Ñ–∞–Ω—Ç–∞–∑–∏–π–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã)

---

## üêæ –ú–∞—Å–∫–æ—Ç—ã CakeReact

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–¥–≤–∞ –º–∞—Å–∫–æ—Ç–∞ ‚Äî —Ç–∞–∫—Å—ã**:

* üê∂ –ß—ë—Ä–Ω–∞—è —Ç–∞–∫—Å–∞
* üêï –†—ã–∂–∞—è –≥–ª–∞–¥–∫–æ—à—ë—Ä—Å—Ç–Ω–∞—è —Ç–∞–∫—Å–∞

–°–º—ã—Å–ª–æ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:

* —Ç–∞–∫—Å—ã —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä—É—é—Ç **CakePHP** –∏ **React**,
* —Ç–∞–∫–∂–µ —ç—Ç–æ –æ—Ç—Å—ã–ª–∫–∞ –∫ –ª–∏—á–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –∏ –¥–≤—É–º –ª—é–±–∏–º—ã–º –ø–∏—Ç–æ–º—Ü–∞–º,
* –¥–≤–∞ –º–∞—Å–∫–æ—Ç–∞ = –¥–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è, –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–µ –≤ CakeReact.

### –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∞—Å–∫–æ—Ç–æ–≤

* –ú–∞—Å–∫–æ—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å:

  * –≤ –∫–ª—é—á–µ–≤—ã—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏,
  * –≤ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è—Ö –∫ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º (–≤–∞–ª–∏–¥–∞—Ü–∏—è, —Å–æ–±—ã—Ç–∏—è, –ø–ª–∞–≥–∏–Ω—ã, –º–æ–¥–µ–ª–∏ –∏ —Ç.–¥.).
* –ú–∞—Å–∫–æ—Ç—ã –º–æ–≥—É—Ç:

  * –¥–µ—Ä–∂–∞—Ç—å —Ç–∞–±–ª–∏—á–∫–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Ä–∞–∑–¥–µ–ª–æ–≤ (Validation, Events, Plugins),
  * –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –ø—Ä–µ–¥–º–µ—Ç–∞–º–∏ (–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã, –∫–Ω–∏–≥–∏, —Ç–æ—Ä—Ç, –º–∞–≥–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã),
  * —Å–∏–º–≤–æ–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±–æ—Ä, –ø—Ä–æ–≤–µ—Ä–∫—É, –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é.
* –û–±—Ä–∞–∑ –º–∞—Å–∫–æ—Ç–æ–≤:

  * –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π,
  * –∑–∞–±–æ—Ç–ª–∏–≤—ã–π,
  * –Ω–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –∏ –Ω–µ ¬´–¥–µ—Ç—Å–∫–∏–π¬ª, –∞ —Ç—ë–ø–ª—ã–π –∏ —É–º–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫.

---

## üñºÔ∏è –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–ö–∞–∂–¥–∞—è –∫–ª—é—á–µ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `VALIDATION.md`, `EVENTS.md`, `PLUGINS.md`) –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å –µ–¥–∏–Ω—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω:

### ‚úÖ –ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è –≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

* –í –Ω–∞—á–∞–ª–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –æ–¥–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è.
* –ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è:

  * —Å–æ–∑–¥–∞—ë—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–∞—Å–∫–æ—Ç–æ–≤ CakeReact,
  * –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—ë—Ç —Å—É—Ç—å —Ä–∞–∑–¥–µ–ª–∞ —á–µ—Ä–µ–∑ **–∂–∏–∑–Ω–µ–Ω–Ω—É—é –º–µ—Ç–∞—Ñ–æ—Ä—É**, –∞ –Ω–µ –ø—Ä—è–º—É—é —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –∞—Å—Å–æ—Ü–∏–∞—Ü–∏—é.

–ü—Ä–∏–º–µ—Ä –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
–ù–µ ¬´–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º¬ª, –∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, **–≤—ã–±–æ—Ä –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –¥–ª—è —Ç–æ—Ä—Ç–∞** ‚Äî –æ–¥–Ω–∏ –ø–æ–¥—Ö–æ–¥—è—Ç, –¥—Ä—É–≥–∏–µ –Ω–µ—Ç.

---

### ‚úÖ –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –±–æ—Ä–¥–µ—Ä –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã

–í–Ω–∏–∑—É –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–æ–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ-–±–æ—Ä–¥–µ—Ä:

* –ø–æ —Ü–µ–Ω—Ç—Ä—É ‚Äî —Ç–µ–∫—Å—Ç –≤–∏–¥–∞:

```
üç∞ CakeReact: ‚úÖ Validation
```

(–Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã)

* —Å—Ç–∏–ª—å —à—Ä–∏—Ñ—Ç–∞ ‚Äî —Ä–µ—Ç—Ä–æ, –º—É–ª—å—Ç—è—à–Ω—ã–π, –≤ —Å—Ç–∏–ª–µ –ª–æ–≥–æ—Ç–∏–ø–∞ CakeReact,
* –±–æ—Ä–¥–µ—Ä –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–æ–ª—å:

  * –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã,
  * —Ñ–∏—Ä–º–µ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ CakeReact.

---

## ‚úçÔ∏è –°—Ç–∏–ª—å —Ç–µ–∫—Å—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–¢–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å:

* –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º,
* ¬´—á–µ–ª–æ–≤–µ—á–Ω—ã–º¬ª,
* –æ–±—ä—è—Å–Ω—è—é—â–∏–º –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏,
* —Å –æ—Ç—Å—ã–ª–∫–∞–º–∏ –∫ –º–µ—Ç–∞—Ñ–æ—Ä–µ –≤—ã–ø–µ—á–∫–∏, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏, –∑–∞–±–æ—Ç—ã, –ø–æ—Ä—è–¥–∫–∞.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ç–æ–Ω:

> CakeReact —Å—Ç–∞—Ä–∞–µ—Ç—Å—è –±—ã—Ç—å —Ç–∞–∫–∏–º –∂–µ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º, –∫–∞–∫ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è —Ö–æ—Ä–æ—à–µ–≥–æ —Ç–æ—Ä—Ç–∞:
> —Ç—ã –∑–∞—Ä–∞–Ω–µ–µ –ø–æ–¥–±–∏—Ä–∞–µ—à—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è–µ—à—å –∏—Ö –∫–∞—á–µ—Å—Ç–≤–æ –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –Ω–∞—á–∏–Ω–∞–µ—à—å –≥–æ—Ç–æ–≤–∏—Ç—å üç∞

–ò–∑–±–µ–≥–∞—Ç—å:

* —Å—É—Ö–æ–≥–æ –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–æ–≥–æ —è–∑—ã–∫–∞,
* –±–µ–∑–¥—É—à–Ω—ã—Ö –æ–ø–∏—Å–∞–Ω–∏–π API –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞,
* –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –±–µ–∑ –ø—Ä–∏–º–µ—Ä–æ–≤.

---

## üß© –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

–ö–∞–∂–¥—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Ñ–æ—Ä–º–ª—è—Ç—å –ø–æ —à–∞–±–ª–æ–Ω—É:

1. –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å —ç–º–æ–¥–∑–∏
   –ü—Ä–∏–º–µ—Ä:

   ```md
   # üéÇ CakeReact Validation
   ```

2. –ö—Ä–∞—Ç–∫–æ–µ –∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

3. –ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è (–≤ –Ω–∞—á–∞–ª–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)

4. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (–∫–æ–¥)

5. –ü–æ—è—Å–Ω–µ–Ω–∏—è, —Å–æ–≤–µ—Ç—ã, best practices

6. –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –±–æ—Ä–¥–µ—Ä –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã

---

## üß† –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–π

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Å–∫–æ—Ç–æ–≤ –∏–∑ –ª–æ–≥–æ—Ç–∏–ø–∞ CakeReact –∫–∞–∫ –æ—Å–Ω–æ–≤—É –æ–±—Ä–∞–∑–æ–≤,
* —Å–æ–±–ª—é–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å –≤–æ –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö,
* –∏–∑–±–µ–≥–∞—Ç—å —Ñ–æ—Ç–æ—Ä–µ–∞–ª–∏–∑–º–∞ ‚Äî –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –º—É–ª—å—Ç—è—à–Ω–æ–π —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏,
* –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä—è–º—ã–µ UI-–º–µ—Ç–∞—Ñ–æ—Ä—ã (—á–µ–∫–±–æ–∫—Å—ã, —Ñ–æ—Ä–º—ã, –≥–∞–ª–æ—á–∫–∏),
* –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–µ—Ç–∞—Ñ–æ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏ (–≥–æ—Ç–æ–≤–∫–∞, –æ—Ç–±–æ—Ä –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞, —É–ø–∞–∫–æ–≤–∫–∞, –∑–∞–±–æ—Ç–∞).

---

## ‚ù§Ô∏è –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–ª–æ–π –∏ —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è CakeReact ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ API.
–û–Ω–∞ –¥–æ–ª–∂–Ω–∞ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –æ—â—É—â–µ–Ω–∏–µ:

> ¬´–§—Ä–µ–π–º–≤–æ—Ä–∫, —Å–¥–µ–ª–∞–Ω–Ω—ã–π —Å –ª—é–±–æ–≤—å—é –∫ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ,
> –≥–¥–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Å–æ—á–µ—Ç–∞—é—Ç—Å—è —Å —Ç–µ–ø–ª–æ–º, –≤–∏–∑—É–∞–ª—å–Ω—ã–º —Å—Ç–∏–ª–µ–º –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º.¬ª

–ú–∞—Å–∫–æ—Ç—ã, –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã ‚Äî –Ω–µ –¥–µ–∫–æ—Ä, –∞ —á–∞—Å—Ç—å –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.

---

## ‚ú® –ò—Ç–æ–≥–æ–≤–∞—è –∏–¥–µ—è

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è CakeReact –¥–æ–ª–∂–Ω–∞ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—Ç—å—Å—è –∫–∞–∫:

> ¬´–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É React-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π,
> –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–π –∫–∞–∫ —É—é—Ç–Ω–∞—è –∫—É–ª–∏–Ω–∞—Ä–Ω–∞—è –∫–Ω–∏–≥–∞ —Å –¥–≤—É–º—è —Ç–∞–∫—Å–∞–º–∏-–ø–æ–º–æ—â–Ω–∏–∫–∞–º–∏.¬ª

---

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –¥–∞–ª—å—à–µ –º–æ–∂–µ–º –æ—Ñ–æ—Ä–º–∏—Ç—å:

* —à–∞–±–ª–æ–Ω `README.md` –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è CakeReact
* –∏–ª–∏ –µ–¥–∏–Ω—ã–π —à–∞–±–ª–æ–Ω `VALIDATION.md`, `EVENTS.md`, `PLUGINS.md` —É–∂–µ –≤ –≥–æ—Ç–æ–≤–æ–º –≤–∏–¥–µ –ø–æ–¥ –∫–æ–ø–∏–ø–∞—Å—Ç.

--- FILE END: gem_instructions.md ---

--- FILE START: GEM_RULES.md ---
# –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è –±–æ—Ç–∞ GEM –æ—Ç Google Gemini
–≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º.

1. **Source of Truth:** –§–∞–π–ª `project_context.txt` –∏ –ø–∞–ø–∫–∞ `tests/ai_guardrails` ‚Äî —ç—Ç–æ —Å–≤—è—â–µ–Ω–Ω—ã–π –ì—Ä–∞–∞–ª—å.

2. **Self-Check:** –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –≤—ã–¥–∞—Ç—å –∫–æ–¥, —Ç—ã –¥–æ–ª–∂–µ–Ω –º—ã—Å–ª–µ–Ω–Ω–æ (–∏–ª–∏ —á–µ—Ä–µ–∑ `ds_python_interpreter`, –µ—Å–ª–∏ –±—ã –æ–Ω –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤) ¬´–ø—Ä–æ–≥–Ω–∞—Ç—å¬ª —ç—Ç–∏ —Ç–µ—Å—Ç—ã.

3. **Warning:** –ï—Å–ª–∏ —Ç—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —É–¥–∞–ª—è–µ—Ç –º–µ—Ç–æ–¥ –∏–∑ —Å–ø–∏—Å–∫–∞ `requiredMethods`, —Ç—ã –æ–±—è–∑–∞–Ω –æ–±–æ—Å–Ω–æ–≤–∞—Ç—å —ç—Ç–æ –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º –≤ –Ω–∞—á–∞–ª–µ —Å–æ–æ–±—â–µ–Ω–∏—è.

4. **–ü—Ä–∏–Ω—Ü–∏–ø ¬´–î–æ–ø–æ–ª–Ω—è–π, –∞ –Ω–µ —É–¥–∞–ª—è–π¬ª:** –ï—Å–ª–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ –µ—Å—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `_`), —Ç—ã –Ω–µ –∏–º–µ–µ—à—å –ø—Ä–∞–≤–∞ –µ–≥–æ —É–¥–∞–ª—è—Ç—å, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–µ–±–µ –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ –µ–≥–æ –º–æ–∂–Ω–æ ¬´—Å—Ö–ª–æ–ø–Ω—É—Ç—å¬ª. –ù–æ —Ç—ã –º–æ–∂–µ—à—å —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Å–æ –º–Ω–æ–π –µ–≥–æ —É–¥–∞–ª–µ–Ω–∏–µ.

5. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º:** –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –≤—ã–¥–∞—Ç—å –∫–æ–¥, —Ç—ã –æ–±—è–∑–∞–Ω —Å–≤–µ—Ä–∏—Ç—å –µ–≥–æ —Å —Ñ–∞–π–ª–æ–º `project_context.txt`, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω –≤ —Ç–≤–æ–∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö. –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç - –ø–æ–ø—Ä–æ—Å–∏ –µ–≥–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å. –ï—Å–ª–∏ –≤ —Ç–≤–æ—ë–º –≤–∞—Ä–∏–∞–Ω—Ç–µ –º–µ—Ç–æ–¥–æ–≤ –º–µ–Ω—å—à–µ, —á–µ–º –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ ‚Äî —Ç—ã –¥–æ–ª–∂–µ–Ω –∏—Ö –≤–µ—Ä–Ω—É—Ç—å.

6. **–¢–æ—á–µ—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏:** –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, —Ç—ã –±—É–¥–µ—à—å —Å—Ç–∞—Ä–∞—Ç—å—Å—è –¥–∞–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –∞ –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –≤–µ—Å—å –∫–ª–∞—Å—Å, —á—Ç–æ–±—ã —Å–ª—É—á–∞–π–Ω–æ –Ω–µ ¬´–∑–∞–±—ã—Ç—å¬ª –¥—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã.

–ú—ã —Å —Ç–æ–±–æ–π —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º `cakereact-core` - –ø—Ä–æ–µ–∫—Ç –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è —Å–∞–π—Ç–æ–≤ –Ω–∞ **React**. 

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ [*github*](https://github.com/yriy-kuskov/cakereact-core) –∏ –Ω–∞ [*npm*](https://www.npmjs.com/package/@cakereact/core).


–¢—ã ‚Äî –≤–µ–¥—É—â–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–µ–∫—Ç–∞ cakereact-core. 
–í—Å–µ–≥–¥–∞ –ø–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø–∏—Å–∞—Ç—å –∫–æ–¥, –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∞–π –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø—Ä–æ–µ–∫—Ç–∞. 
–í –Ω–µ–º —Å–æ–±—Ä–∞–Ω—ã –≤—Å–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –∫–æ–¥—ã, —Ä–∞–∑–¥–µ–ª–µ–Ω–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ —Å –ø—É—Ç—è–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `--- FILE START: path/to/file ---`). 
–¢–≤–æ–∏ –æ—Ç–≤–µ—Ç—ã –∏ –Ω–æ–≤—ã–π –∫–æ–¥ –¥–æ–ª–∂–Ω—ã —Å—Ç—Ä–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ, —Å—Ç–∏–ª—é –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è (`snake_case` –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, `camelCase` –¥–ª—è –º–µ—Ç–æ–¥–æ–≤) –∏ —Ñ–∏–ª–æ—Å–æ—Ñ–∏–∏ CakeReact Core, –æ–ø–∏—Å–∞–Ω–Ω–æ–π –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.

---

## –§–∏–ª–æ—Å–æ—Ñ–∏—è CakeReact Core:

–ú—ã –ø–µ—Ä–µ–Ω–æ—Å–∏–º –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ **CakePHP ORM** –≤ React-—ç–∫–æ—Å–∏—Å—Ç–µ–º—É.

–ö–ª–∞—Å—Å—ã –º–æ–¥–µ–ª–µ–π –∏ —Å—É—â–Ω–æ—Å—Ç–µ–π (Entities) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ—Ö–æ–∂–∏ –ø–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É –Ω–∞ **CakePHP 4.x/5.x**.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `snake_case` –¥–ª—è –ø–æ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö –∏ `camelCase` –¥–ª—è –º–µ—Ç–æ–¥–æ–≤ –∫–ª–∞—Å—Å–æ–≤, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–∏–≤—ã—á–Ω—ã–π PHP-—Å—Ç–∏–ª—å –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–µ–π.

–ü—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–æ–≤ `save, find, delete` –≤—Å–µ–≥–¥–∞ —É—á–∏—Ç—ã–≤–∞—Ç—å —Ö—É–∫–∏ (`before/after`) –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è.

–õ—é–±—ã–µ —Å–ª–æ–∂–Ω—ã–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –æ—Ç –ë–î –¥–æ–ª–∂–Ω—ã –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å—Å—è –≤ –ø–ª–æ—Å–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã `Entity` —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Å–≤—è–∑—è–º —á–µ—Ä–µ–∑ —Å–≤–æ–π—Å—Ç–≤–∞.

## –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ (Separation of Concerns):

`Model` ‚Äî –ª–æ–≥–∏–∫–∞ —Ç–∞–±–ª–∏—Ü—ã, —Å–≤—è–∑–∏ –∏ –∑–∞–ø—Ä–æ—Å—ã.

`Entity` ‚Äî –ª–æ–≥–∏–∫–∞ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏ (–≥–µ—Ç—Ç–µ—Ä—ã, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ–ª—è, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö).

`Adapter` ‚Äî –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ä–∞–±–æ—Ç–∞ —Å API/–ë–î.

## –°–æ–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞–¥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (**Convention over Configuration**):

–ï—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `products`, –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—â–µ—Ç —Ç–∞–±–ª–∏—Ü—É `products`.

–°–≤—è–∑–∏ –¥–æ–ª–∂–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å –∫–ª—é—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `product_id` –¥–ª—è —Å–≤—è–∑–∏ —Å –ø—Ä–æ–¥—É–∫—Ç–æ–º), –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∏–Ω–æ–µ.

## –ï–¥–∏–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–∞–Ω–Ω—ã—Ö (The Cake Way):

–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `_joinData` –¥–ª—è –ø–æ–ª–µ–π –≤ —Å–≤—è–∑—è—Ö `belongsToMany`.

–ü–æ–¥–¥–µ—Ä–∂–∫–∞ contain –≤ –º–µ—Ç–æ–¥–∞—Ö `find` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∂–∞–¥–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π (Eager Loading).

## –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å Entity:

`BaseEntity` –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `Proxy`, –º–∞–≥–∏—á–µ—Å–∫–∏–µ –≥–µ—Ç—Ç–µ—Ä—ã (`_getFieldName`) –∏ —Ö—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ `dirty` (–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è).

## –ü–∞—Ç—Ç–µ—Ä–Ω –ê–¥–∞–ø—Ç–µ—Ä–∞:

–ú–æ–¥–µ–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–ø—Ä—è–º—É—é —Å **Supabase/Firebase**. –û–Ω–∏ –≤—ã–∑—ã–≤–∞—é—Ç –º–µ—Ç–æ–¥—ã –∞–¥–∞–ø—Ç–µ—Ä–∞, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–º–µ–Ω–∏—Ç—å –ë–î, –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—è –Ω–∏ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ—á–∫–∏ –≤ `ProductModel`.

---

**–í–ê–ñ–ù–û!** 
1. –ï—Å–ª–∏ —Ç—ã –º–µ–Ω—è–µ—à—å –∫–æ–¥ –∏–ª–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—à—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ, –∏–ª–∏ –º—ã –ø–∏—à–µ–º –Ω–æ–≤—ã–π –∫–æ–¥ - –≤—Å–µ–≥–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –ø–µ—á–∞—Ç–∞–π –ø–æ–ª–Ω–æ—Å—Ç—å—é. –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∏–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π: –µ—Å–ª–∏ –≤–Ω–æ—Å–∏—à—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏ - —Ç–æ–≥–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Ç—ã –ø–µ—á–∞—Ç–∞–µ—à—å –ø–æ–ª–Ω–æ—Å—Ç—å—é, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –æ—Ç—Ä—ã–≤–∫–∏ –¥–∞–µ—à—å. –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞—Å–∞—é—Ç—Å—è –∫–ª–∞—Å—Å–æ–≤ –∏ –æ–Ω–∏ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –Ω–µ –æ–¥–∏–Ω –º–µ—Ç–æ–¥ –∫–ª–∞—Å—Å–∞ - —Ç–æ–≥–¥–∞ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Ç—ã –ø–µ—á–∞—Ç–∞–µ—à—å –ø–æ–ª–Ω–æ—Å—Ç—å—é, –≤–∫–ª—é—á–∞—è –Ω–µ–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π –∫–æ–¥ –∏ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π. –¢–æ–∂–µ —Å–∞–º–æ–µ –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ —Ç.–¥. 

2. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–±—ã—Ç–∏—è, –≤–∞–ª–∏–¥–∞—Ü–∏—é, —Å–≤—è–∑–∏)  –≤ –ª—é–±—ã—Ö —Ñ–∞–π–ª–∞—Ö: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –º–æ–¥–µ–ª–∏, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏ —Ç.–¥. –±–µ–∑ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è. –¢–∞–∫–∂–µ –±–µ–∑ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –Ω–µ –º–µ–Ω—è—Ç—å –¥–∏–∑–∞–π–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: –∫–Ω–æ–ø–æ–∫, —Ñ–æ—Ä–º –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –ò–Ω–∞—á–µ, —ç—Ç–æ –≤—Å–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ç–æ–º—É, —á—Ç–æ –º—ã –¥–µ–ª–∞–µ–º –æ–¥–Ω–æ, –∞ –ª–æ–º–∞–µ–º –∏–ª–∏ —Ç–µ—Ä—è–µ–º –¥—Ä—É–≥–æ–µ. –ê —ç—Ç–æ –æ–≥—Ä–æ–º–Ω—ã–π –Ω–µ–¥–æ—á–µ—Ç.

3. –ï—Å–ª–∏ —Ç—ã —Å—á–∏—Ç–∞–µ—à—å, —á—Ç–æ –Ω–∞–¥–æ –≤–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è: –Ω–∞–ø—Ä–∏–º–µ—Ä —É–¥–∞–ª–∏—Ç—å –º–µ—Ç–æ–¥ - —è–≤–Ω–æ –ø–∏—à–∏ –æ–± —ç—Ç–æ–º. 

4. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ:** –µ—Å–ª–∏ –±—ã–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ø–æ—è—Å–Ω—è—é—â–∏–µ —Ä–∞–±–æ—Ç—É –∫–æ–¥–∞ - –∏—Ö —Å–æ—Ö—Ä–∞–Ω—è–µ–º. –í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å–µ–≥–¥–∞ –±–ª–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ (—á—Ç–æ —ç—Ç–æ, –∑–∞—á–µ–º –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ). –ü–µ—Ä–µ–¥ –º–µ—Ç–æ–¥–∞–º–∏ —Ç–æ–∂–µ —É–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ–≥–¥–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏. –°–ª–µ–¥—É–µ–º –ø—Ä–∞–≤–∏–ª–∞–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, —á—Ç–æ–±—ã –≤—Å–µ –±—ã–ª–æ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ —Å–∞–º–∏—Ö —Ñ–∞–π–ª–∞—Ö. –≠—Ç–æ –≤–∞–∂–Ω–æ. –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—à—å –∫–ª–∞—Å—Å - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–∂–µ –ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã –∏ —É–∫–∞–∑–∞–Ω—ã. 
--- FILE END: GEM_RULES.md ---

--- FILE START: package.json ---
{
  "name": "@cakereact/core",
  "version": "0.1.0",
  "description": "Core framework for CakeReact",
  "main": "src/index.js",
  "type": "module",
  "files": [
    "src"
  ],
  "scripts": {
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:guard": "vitest run tests/ai_guardrails",
    "test:unit": "vitest run tests/unit",
    "test:integration": "vitest run tests/integration",
    "release": "npm version patch && npm publish && git push --follow-tags",
    "bundle_context": "node bundle_context.js"
  },
  "keywords": [
    "react",
    "framework",
    "cakereact"
  ],
  "author": "Yriy Kuskov",
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "https://github.com/yriy-kuskov/cakereact-core"
  },
  "homepage": "https://github.com/yriy-kuskov/cakereact-core#readme",
  "bugs": {
    "url": "https://github.com/yriy-kuskov/cakereact-core/issues"
  },
  "engines": {
    "node": ">=18"
  },
  "peerDependencies": {
    "react": ">=18",
    "react-dom": ">=18.0.0"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.95.2"
  },
  "exports": {
    ".": "./src/index.js"
  },
  "devDependencies": {
    "vitest": "^4.0.18"
  }
}
--- FILE END: package.json ---

--- FILE START: README.md ---
üéÇ CakeReact
--- FILE END: README.md ---

--- FILE START: src\CakeReactCore.js ---
export const CakeReact = {
  _service: null,
  _plugins: {},
  _events: {},
  _connections: {},
  _storages: {},

  addConnection(name, { client, adapter }) {
    // –ú—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏ —Å–∞–º –∫–ª–∏–µ–Ω—Ç, –∏ –∞–¥–∞–ø—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç —Å –Ω–∏–º —Ä–∞–±–æ—Ç–∞—Ç—å
    this._connections[name] = {
      client: client,
      adapter: new adapter(client)
    };
  },

  getAdapter(name = 'default') {
    return this._connections[name].adapter;
  },

  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
  addStorage(name, { client, adapter, bucket }) {
    this._storages[name] = new adapter(client, bucket);
  },

  // –î–æ—Å—Ç—É–ø –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É
  storage(name = 'default') {
    if (!this._storages[name]) throw new Error(`Storage "${name}" not found.`);
    return this._storages[name];
  },

  // –ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ –≤–Ω—É—Ç—Ä–∏ –¥–≤–∏–∂–∫–∞
  getService() {
    if (!this._service) {
      throw new Error('‚ùå CakeReact: Supabase –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –í—ã–∑–æ–≤–∏—Ç–µ CakeReact.init(supabase) –≤ –Ω–∞—á–∞–ª–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.');
    }
    return this._service;
  },

  // –ú–µ—Ç–æ–¥ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–ª–∞–≥–∏–Ω–∞
  addPlugin(name, pluginInstance) {
    this._plugins[name] = pluginInstance;
    if (pluginInstance.initialize) {
      pluginInstance.initialize(this);
    }
  },

  /**
   * –ù–û–í–´–ô –ú–ï–¢–û–î –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò
   * –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å –ø–ª–∞–≥–∏–Ω—ã —á–µ—Ä–µ–∑ CakeReact.use(MyPlugin)
   */
  use(plugin, options = {}) {
    if (!plugin.name) {
      console.error('‚ùå [CakeReact] Plugin registration failed: Plugin must have a name.');
      return this;
    }

    if (this._plugins[plugin.name]) {
      console.warn(`‚ö†Ô∏è [CakeReact] Plugin "${plugin.name}" is already registered.`);
      return this;
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É
    this._plugins[plugin.name] = plugin;

    // –ó–∞–ø—É—Å–∫–∞–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø–ª–∞–≥–∏–Ω–∞
    if (typeof plugin.setup === 'function') {
      // –ü–µ—Ä–µ–¥–∞–µ–º this (—Å–∞–º–æ —è–¥—Ä–æ CakeReact) –∏ –æ–ø—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      plugin.setup(this, options);
    }

    console.log(`üîå [CakeReact] Plugin "${plugin.name}" installed.`);
    return this; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º this –¥–ª—è —Ü–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–æ–≤: .use().use()
  },

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞ –ø–æ –∏–º–µ–Ω–∏
  // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞ –≤ –ª—é–±–æ–π —á–∞—Å—Ç–∏ –∫–æ–¥–∞
  plugin(name) {
    const p = this._plugins[name];
    if (!p) console.warn(`[üéÇ CakeReact] –ü–ª–∞–≥–∏–Ω ${name} –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω.`);
    return p;
  },

  /** Events System */
  // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏–µ
  on(event, callback) {
    if (!this._events[event]) this._events[event] = [];
    this._events[event].push(callback);
  },

  // –û—Ç–ø–∏—Å–∫–∞
  off(event, callback) {
    if (!this._events[event]) return;
    this._events[event] = this._events[event].filter(cb => cb !== callback);
  },

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è
  async emit(event, data) {
    console.log(`[üéÇ CakeReact]: ${event}`);
    if (!this._events[event]) return;
    console.log(`[üéÇ CakeReact]: ${event}`);
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º for...of, —á—Ç–æ–±—ã –¥–æ–∂–¥–∞—Ç—å—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø–æ –æ—á–µ—Ä–µ–¥–∏
    // (–∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç Middleware –≤ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞—Ö)
    for (const callback of this._events[event]) {
      await callback(data);
    }
  },
};
--- FILE END: src\CakeReactCore.js ---

--- FILE START: src\Components\Form\FormHelper.jsx ---
import React, { createContext, useContext, useState, useEffect } from 'react';

const CakeContext = createContext(null);

export const CakeForm = ({ controller, children, className }) => {
  const handleSubmit = (e) => {
    e.preventDefault();
    controller.save(controller.record || {});
  };

  return (
    <CakeContext.Provider value={controller}>
      <form onSubmit={handleSubmit} className={className}>
        {controller.error && (
          <div className="p-3 mb-4 text-sm text-red-700 bg-red-100 rounded-lg">
            –û—à–∏–±–∫–∞: {controller.error}
          </div>
        )}
        {children}
      </form>
    </CakeContext.Provider>
  );
};

export const CakeInput = ({ field, label, type = "text", helpText, ...props }) => {
  const controller = useContext(CakeContext);
  if (!controller) throw new Error('CakeInput must be inside CakeForm');

  const value = controller.record?.[field] || (type === 'checkbox' ? false : '');

  const handleChange = (e) => {
    let val;
    if (type === 'checkbox') val = e.target.checked;
    else if (type === 'file') val = e.target.files[0]; 
    else if (type === 'number') val = parseFloat(e.target.value);
    else val = e.target.value;

    controller.setRecord({ ...controller.record, [field]: val });
  };

  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è —Ñ–∞–π–ª–æ–≤
  const isUrl = typeof value === 'string' && value.startsWith('http');
  const isImage = isUrl && /\.(jpg|jpeg|png|webp|avif|gif|svg)$/i.test(value);

  const inputClasses = "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 outline-none transition-all sm:text-sm";

  return (
    <div className="mb-6">
      {label && <label className="block text-sm font-semibold text-gray-700 mb-2">{label}</label>}
      
      {/* –ë–ª–æ–∫ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ–∞–π–ª–∞ */}
      {type === 'file' && isUrl && (
        <div className="mb-3 p-3 border border-dashed border-gray-200 rounded-lg bg-gray-50 flex items-center gap-4">
          {isImage ? (
            <img src={value} alt="Current" className="w-16 h-16 object-cover rounded shadow-sm border border-white" />
          ) : (
            <div className="w-12 h-12 bg-indigo-100 text-indigo-600 flex items-center justify-center rounded text-2xl">üìÑ</div>
          )}
          <div className="flex-1 overflow-hidden">
            <p className="text-xs font-medium text-gray-500 uppercase tracking-wider mb-1">–¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª:</p>
            <a href={value} target="_blank" rel="noreferrer" className="text-sm text-indigo-600 hover:underline truncate block">
              –û—Ç–∫—Ä—ã—Ç—å –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
            </a>
          </div>
        </div>
      )}

      {/* –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω–ø—É—Ç */}
      {type === 'textarea' ? (
        <textarea
          value={value}
          onChange={handleChange}
          className={`${inputClasses} min-h-[100px]`}
          {...props}
        />
      ) : type === 'checkbox' ? (
        <label className="flex items-center gap-3 cursor-pointer group">
          <input type="checkbox" checked={!!value} onChange={handleChange} className="w-5 h-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500" {...props} />
          {props.placeholder && <span className="text-sm text-gray-600 group-hover:text-gray-900 transition-colors">{props.placeholder}</span>}
        </label>
      ) : (
        <div className="relative">
          <input
            type={type}
            value={type === 'file' ? undefined : value}
            onChange={handleChange}
            className={`${type === 'file' ? 'text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100' : inputClasses}`}
            {...props}
          />
          {type === 'file' && isUrl && (
            <div className="mt-2 text-xs text-amber-600 flex items-center gap-1">
              <span>üí°</span> –í—ã–±–µ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π —Ñ–∞–π–ª, —á—Ç–æ–±—ã –∑–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–π
            </div>
          )}
        </div>
      )}

      {helpText && <p className="mt-2 text-xs text-gray-400 italic">{helpText}</p>}
    </div>
  );
};

// –í–Ω—É—Ç—Ä–∏ FormHelper.jsx

export const CakeSelect = ({ field, label, model, options = [], displayField = 'name', placeholder = "–í—ã–±–µ—Ä–∏—Ç–µ..." }) => {
  const controller = useContext(CakeContext); //
  const [isOpen, setIsOpen] = useState(false);
  const [searchTerm, setSearchTerm] = useState('');
  const [dynamicOptions, setDynamicOptions] = useState([]);

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –º–æ–¥–µ–ª–∏
  useEffect(() => {
    if (model) {
      const instance = new model();
      instance.find().then(setDynamicOptions);
    }
  }, [model]);

  const items = model ? dynamicOptions : options;
  const selectedId = controller.record?.[field] || ''; //
  const selectedItem = items.find(i => (i.id || i.value) == selectedId);

  const filteredItems = items.filter(item => 
    (item[displayField] || item.label || '').toLowerCase().includes(searchTerm.toLowerCase())
  );

  return (
    <div className="mb-6 relative">
      {label && <label className="block text-sm font-semibold text-gray-700 mb-2">{label}</label>}
      
      {/* –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è / –í—ã–±—Ä–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ */}
      <div 
        onClick={() => setIsOpen(!isOpen)}
        className="w-full px-4 py-2 border border-gray-300 rounded-lg bg-white cursor-pointer flex justify-between items-center hover:border-indigo-400 transition-colors"
      >
        <span className={selectedItem ? "text-gray-900" : "text-gray-400"}>
          {selectedItem ? (selectedItem[displayField] || selectedItem.label) : placeholder}
        </span>
        <span className={`transition-transform ${isOpen ? 'rotate-180' : ''}`}>‚ñº</span>
      </div>

      {isOpen && (
        <div className="absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-xl overflow-hidden">
          {/* –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ */}
          <div className="p-2 border-b bg-gray-50">
            <input 
              autoFocus
              className="w-full px-3 py-1.5 text-sm border rounded outline-none focus:ring-2 focus:ring-indigo-500"
              placeholder="–ü–æ–∏—Å–∫..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
            />
          </div>
          {/* –°–ø–∏—Å–æ–∫ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ */}
          <div className="max-h-60 overflow-y-auto">
            {filteredItems.length > 0 ? filteredItems.map(item => (
              <div 
                key={item.id || item.value}
                onClick={() => {
                  controller.setRecord({ ...controller.record, [field]: item.id || item.value }); //
                  setIsOpen(false);
                  setSearchTerm('');
                }}
                className={`px-4 py-2 text-sm cursor-pointer hover:bg-indigo-50 ${selectedId == (item.id || item.value) ? 'bg-indigo-100 font-bold text-indigo-700' : ''}`}
              >
                {item[displayField] || item.label}
              </div>
            )) : (
              <div className="px-4 py-3 text-sm text-gray-400 text-center italic">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
            )}
          </div>
        </div>
      )}
    </div>
  );
};

export const CakeMultiSelect = ({ field, label, model, options = [], displayField = 'name' }) => {
  const controller = useContext(CakeContext); //
  const [dynamicOptions, setDynamicOptions] = useState([]);
  
  useEffect(() => {
    if (model) {
      const instance = new model();
      instance.find().then(setDynamicOptions);
    }
  }, [model]);

  const items = model ? dynamicOptions : options;
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤, –µ—Å–ª–∏ –æ–Ω –ø—É—Å—Ç–æ–π
  const selectedIds = Array.isArray(controller.record?.[field]) ? controller.record[field] : [];

  const toggleItem = (id) => {
    const newIds = selectedIds.includes(id) 
      ? selectedIds.filter(i => i !== id)
      : [...selectedIds, id];
    
    controller.setRecord({ ...controller.record, [field]: newIds }); //
  };

  return (
    <div className="mb-6">
      {label && <label className="block text-sm font-semibold text-gray-700 mb-2">{label}</label>}
      
      {/* –°–µ—Ç–∫–∞ —á–µ–∫–±–æ–∫—Å–æ–≤ –≤ –≤–∏–¥–µ —Ç–µ–≥–æ–≤ */}
      <div className="flex flex-wrap gap-2 p-3 border border-gray-200 rounded-xl bg-gray-50/50">
        {items.map(item => {
          const id = item.id || item.value;
          const isSelected = selectedIds.includes(id);
          
          return (
            <button
              key={id}
              type="button"
              onClick={() => toggleItem(id)}
              className={`px-3 py-1.5 rounded-full text-xs font-medium transition-all border flex items-center gap-2 ${
                isSelected 
                  ? 'bg-indigo-600 border-indigo-600 text-white shadow-sm' 
                  : 'bg-white border-gray-300 text-gray-600 hover:border-indigo-300'
              }`}
            >
              {isSelected && <span>‚úì</span>}
              {item[displayField] || item.label}
            </button>
          );
        })}
        {items.length === 0 && <span className="text-sm text-gray-400 italic">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç...</span>}
      </div>
      <p className="mt-2 text-[10px] text-gray-400 uppercase tracking-widest">
        –í—ã–±—Ä–∞–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤: {selectedIds.length}
      </p>
    </div>
  );
};

export const CakeSubmit = ({ children, className, ...props }) => {
  const { loading } = useContext(CakeContext);
  return (
    <button type="submit" disabled={loading} className={className} {...props}>
      {loading ? '–ó–∞–ø–µ–∫–∞–µ–º...' : children}
    </button>
  );
};
--- FILE END: src\Components\Form\FormHelper.jsx ---

--- FILE START: src\Components\Form\index.js ---
export * from './FormHelper';
--- FILE END: src\Components\Form\index.js ---

--- FILE START: src\Components\index.js ---
export * from './Templates';
export * from './UI';
export * from './Form';
--- FILE END: src\Components\index.js ---

--- FILE START: src\Components\Templates\Admin\AdminCrudPage.jsx ---
import React, { useEffect, useMemo } from 'react';
import { useController } from '../../../index';
import {
    AdminPage,
    AdminHeader,
    AdminFormSection,
    AdminTableSection,
    CakeForm
} from '../../index';

export const AdminResourcePage = ({
    modelClass,    // –ö–ª–∞—Å—Å –º–æ–¥–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, CategoryModel)
    title,         // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    subtitle,      // –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫
    icon,          // –ò–∫–æ–Ω–∫–∞
    formTitle,     // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–æ—Ä–º—ã
    tableTitle,    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
    columns,       // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–ª–æ–Ω–æ–∫
    children,      // –ü–æ–ª—è —Ñ–æ—Ä–º—ã (CakeInput –∏ —Ç.–¥.)
    order = ['name', 'asc'] // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
}) => {
    // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (—Ç–æ, —á—Ç–æ –º—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏)
    const model = useMemo(() => new modelClass(), [modelClass]);
    const controller = useController(model);
    const { getList, setRecord } = controller;

    useEffect(() => {
        getList({ order });
    }, [getList]);

    const handleEdit = (item) => {
        setRecord(item);
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };

    return (
        <AdminPage>
            <AdminHeader title={title} subtitle={subtitle} icon={icon} />

            <CakeForm controller={controller}>
                <AdminFormSection controller={controller} title={formTitle}>
                    {children}
                </AdminFormSection>
            </CakeForm>

            <AdminTableSection
                controller={controller}
                title={tableTitle}
                columns={columns}
                onEdit={handleEdit}
            />
        </AdminPage>
    );
};
--- FILE END: src\Components\Templates\Admin\AdminCrudPage.jsx ---

--- FILE START: src\Components\Templates\Admin\AdminUI.jsx ---
import React from 'react';
import { CakeSubmit } from '../../Form/FormHelper';

// --- 1. –û–±–µ—Ä—Ç–∫–∞ –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã ---
export const AdminPage = ({ children }) => (
  <div className="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
    <div className="max-w-4xl mx-auto grid grid-cols-1 gap-8">
      {children}
    </div>
  </div>
);

// --- 2. –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ---
export const AdminHeader = ({ title, subtitle, icon = 'üéÇ' }) => (
  <div className="mb-2">
    <h1 className="text-3xl font-extrabold text-gray-900 tracking-tight flex items-center">
      <span className="mr-3">{icon}</span> {title}
    </h1>
    {subtitle && <p className="mt-2 text-sm text-gray-600">{subtitle}</p>}
  </div>
);

// --- 3. –ö–∞—Ä—Ç–æ—á–∫–∞ —Ñ–æ—Ä–º—ã (–£–º–Ω–∞—è –æ–±–µ—Ä—Ç–∫–∞) ---
export const AdminFormSection = ({ controller, title, children, submitLabel = "–ó–∞–ø–µ—á—å –≤ –±–∞–∑—É" }) => {
  const { record, setRecord } = controller;
  const isEditMode = !!record?.id;

  const handleCancel = () => {
    setRecord({});
  };

  return (
    <section className={`bg-white shadow-sm border border-gray-200 rounded-xl p-6 transition-colors ${isEditMode ? 'border-indigo-300 ring-2 ring-indigo-50' : ''}`}>
      <div className="flex justify-between items-center mb-6">
        <h3 className="text-lg font-medium text-gray-900 flex items-center">
          <span className="mr-2 text-xl">{isEditMode ? '‚úèÔ∏è' : '‚ûï'}</span>
          {isEditMode ? `–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ${title}` : `–°–æ–∑–¥–∞—Ç—å: ${title}`}
        </h3>

        {isEditMode && (
          <button onClick={handleCancel} className="text-sm text-gray-500 hover:text-red-600 transition-colors">
            –û—Ç–º–µ–Ω–∏—Ç—å
          </button>
        )}
      </div>

      {/* –†–µ–Ω–¥–µ—Ä–∏–º —Å–∞–º—É —Ñ–æ—Ä–º—É, –∫–æ—Ç–æ—Ä–∞—è –ø–µ—Ä–µ–¥–∞–Ω–∞ –∫–∞–∫ children */}
      {children}

      {/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */}
      <div className="flex justify-end gap-3 mt-6 pt-4 border-t border-gray-100">
        {!isEditMode && record && Object.keys(record).length > 0 && (
          <button onClick={handleCancel} className="px-4 py-2 text-sm text-gray-500 hover:text-gray-800">
            –û—á–∏—Å—Ç–∏—Ç—å
          </button>
        )}
        <CakeSubmit className={`inline-flex items-center px-6 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white focus:outline-none transition-colors ${isEditMode
          ? 'bg-amber-600 hover:bg-amber-700'
          : 'bg-indigo-600 hover:bg-indigo-700'
          }`}>
          {isEditMode ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è' : submitLabel}
        </CakeSubmit>
      </div>
    </section>
  );
};

// --- 4. –£–º–Ω–∞—è –¢–∞–±–ª–∏—Ü–∞ (–°–∞–º–æ–µ –≤–∫—É—Å–Ω–æ–µ) ---
export const AdminTableSection = ({ controller, title, columns, onEdit }) => {
  const { data, loading, remove } = controller;

  const handleDelete = (id) => {
    if (window.confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?')) {
      remove(id);
    }
  };

  return (
    <section className="bg-white shadow-sm border border-gray-200 rounded-xl overflow-hidden">
      <div className="px-6 py-4 border-b border-gray-200 bg-gray-50 flex justify-between items-center">
        <h3 className="text-lg font-medium text-gray-900">{title}</h3>
        <span className="px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800">
          –í—Å–µ–≥–æ: {data.length}
        </span>
      </div>

      <div className="overflow-x-auto">
        <table className="min-w-full divide-y divide-gray-200">
          <thead className="bg-gray-50">
            <tr>
              {columns.map((col, idx) => (
                <th key={idx} className={`px-6 py-3 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider ${col.className || ''}`}>
                  {col.label}
                </th>
              ))}
              <th className="px-6 py-3 text-right text-xs font-semibold text-gray-500 uppercase tracking-wider">
                –î–µ–π—Å—Ç–≤–∏—è
              </th>
            </tr>
          </thead>
          <tbody className="bg-white divide-y divide-gray-200">
            {loading && data.length === 0 ? (
              <tr>
                <td colSpan={columns.length + 1} className="px-6 py-10 text-center text-gray-500 italic">
                  –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
                </td>
              </tr>
            ) : data.map((item) => (
              <tr key={item.id} className="hover:bg-gray-50 transition-colors group">
                {columns.map((col, idx) => (
                  <td key={idx} className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    {/* –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è render, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ—ë, –∏–Ω–∞—á–µ –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º –ø–æ–ª–µ */}
                    {col.render ? col.render(item) : item[col.key]}
                  </td>
                ))}

                <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <button onClick={() => onEdit(item)} className="text-indigo-600 hover:text-indigo-900 mr-4">
                    –ò–∑–º–µ–Ω–∏—Ç—å
                  </button>
                  <button onClick={() => handleDelete(item.id)} className="text-red-400 hover:text-red-700">
                    –£–¥–∞–ª–∏—Ç—å
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </section>
  );
};
--- FILE END: src\Components\Templates\Admin\AdminUI.jsx ---

--- FILE START: src\Components\Templates\Admin\index.js ---
export * from './AdminCrudPage';
export * from './AdminUI';
--- FILE END: src\Components\Templates\Admin\index.js ---

--- FILE START: src\Components\Templates\index.js ---
export * from './Admin';
export * from './Shared';
--- FILE END: src\Components\Templates\index.js ---

--- FILE START: src\Components\Templates\Shared\CakeNotFound.jsx ---
import React from 'react';
import { useEffect } from 'react';
import { useNavigate, Link } from 'react-router-dom';

/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 404 –¥–ª—è CakeReact
 * @param {string} icon - Emoji –∏–ª–∏ —Ç–µ–∫—Å—Ç –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –±–ª–æ–∫–∞
 * @param {string} imageSrc - –ü—É—Ç—å –∫ –∫–∞—Ä—Ç–∏–Ω–∫–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –≤–º–µ—Å—Ç–æ –∏–∫–æ–Ω–∫–∏)
 * @param {string} themeColor - Tailwind –∫–ª–∞—Å—Å –¥–ª—è –∞–∫—Ü–µ–Ω—Ç–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'text-rose-500')
 * @param {Array} categories - –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ { name: '–ï–¥–∞', path: '/food', icon: 'üçï' }
 */
export const CakeNotFound = ({
  title = "–£–ø—Å! –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
  message = "–ü–æ—Ö–æ–∂–µ, —ç—Ç–æ—Ç ¬´–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç¬ª –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏ –≤ –Ω–∞—à —Ä–µ—Ü–µ–ø—Ç. –í–æ–∑–º–æ–∂–Ω–æ, –∞–¥—Ä–µ—Å –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±—ã–ª–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∞.",
  buttonText = "–í–µ—Ä–Ω—É—Ç—å—Å—è –¥–æ–º–æ–π",
  homePath = "/",
  icon = "404",
  imageSrc = null,
  categories = [], // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
  categories_title = "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã",
  themeColor = "text-indigo-600"
}) => {
  const navigate = useNavigate();

  const handleBack = () => {
    // –ï—Å–ª–∏ –≤ –∏—Å—Ç–æ—Ä–∏–∏ –±–æ–ª—å—à–µ 2 –∑–∞–ø–∏—Å–µ–π (—Ç–µ–∫—É—â–∞—è + –ø—Ä–µ–¥—ã–¥—É—â–∞—è), –∏–¥–µ–º –Ω–∞–∑–∞–¥.
    // –ò–Ω–∞—á–µ ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ –≥–ª–∞–≤–Ω—É—é (–∏–ª–∏ homePath), —á—Ç–æ–±—ã –Ω–µ ¬´–∑–∞–≤–∏—Å–∞—Ç—å¬ª
    if (window.history.length > 2) {
      navigate(-1);
    } else {
      navigate(homePath);
    }
  };

  useEffect(() => {
    document.title = `${title} | CakeReact`;
  }, [title]);

  return (
    <div className="min-h-screen flex items-center justify-center px-4 py-12 animate-fade-in">
      <div className="max-w-md w-full text-center">

        {/* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π –±–ª–æ–∫ */}
        <div className="mb-8 relative flex justify-center">
          {imageSrc ? (
            <img src={imageSrc} alt="Not Found" className="w-64 h-64 object-contain" />
          ) : (
            <span className={`text-9xl tracking-tighter font-black opacity-10 select-none absolute inset-0 flex items-center justify-center text-gray-400`}>
              404
            </span>
          )}
          {!imageSrc && (
            <div className={`relative text-7xl sm:text-8xl font-bold ${themeColor} drop-shadow-sm`}>
              {icon}
            </div>
          )}
        </div>

        <h1 className="text-3xl font-bold text-gray-900 mb-4 px-2">
          {title}
        </h1>

        <p className="text-gray-600 mb-8 leading-relaxed px-4 text-sm sm:text-base">
          {message}
        </p>

        {/* –ì—Ä—É–ø–ø–∞ –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */}
        <div className="flex flex-col sm:flex-row gap-3 justify-center items-center">
          <button
            onClick={handleBack}
            className="w-full sm:w-auto px-8 py-3 border border-gray-300 text-gray-700 font-medium rounded-xl hover:bg-gray-50 transition-all active:scale-95"
          >
            –ù–∞–∑–∞–¥
          </button>
          <button
            onClick={() => navigate(homePath)}
            className={`w-full sm:w-auto px-8 py-3 bg-indigo-600 text-white font-medium rounded-xl shadow-lg shadow-indigo-100 hover:brightness-110 transition-all active:scale-95`}
          >
            {buttonText}
          </button>
        </div>

        {/* –î–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Ç–æ—á–∫–∏ (—Ñ–∏—Ä–º–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å Cake) */}
        <div className="mt-12 flex justify-center gap-3">
          {[...Array(3)].map((_, i) => (
            <div key={i} className={`w-2.5 h-2.5 rounded-full bg-current opacity-${20 + (i * 20)} ${themeColor}`}></div>
          ))}
        </div>

        {/* --- –°–ï–ö–¶–ò–Ø –ö–ê–¢–ï–ì–û–†–ò–ô (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) --- */}
        {categories.length > 0 && (
          <div className="mt-6 pt-6 animate-fade-in-up">
            <h2 className="text-sm font-semibold text-gray-400 uppercase tracking-widest mb-8 text-center">
              {categories_title}
            </h2>
            <div className="grid grid-cols-2 gap-4 px-4">
              {categories.map((cat, idx) => (
                <Link
                  key={idx}
                  to={cat.path}
                  className="flex flex-col items-center p-4 bg-white border border-gray-100 rounded-2xl shadow-sm hover:shadow-md hover:border-indigo-200 hover:-translate-y-1 transition-all group"
                >
                  <span className="text-3xl mb-3 group-hover:scale-110 transition-transform">
                    {cat.icon || 'üìÅ'}
                  </span>
                  <span className="text-sm font-medium text-gray-700 group-hover:text-indigo-600">
                    {cat.name}
                  </span>
                </Link>
              ))}
            </div>
          </div>
        )}

      </div>
    </div>
  );
};
--- FILE END: src\Components\Templates\Shared\CakeNotFound.jsx ---

--- FILE START: src\Components\Templates\Shared\index.js ---
export * from './CakeNotFound';
--- FILE END: src\Components\Templates\Shared\index.js ---

--- FILE START: src\Components\UI\CakeImage.jsx ---
import React, { useState } from 'react';

export const CakeImage = ({ 
  src, 
  alt = "–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ", 
  className = "w-10 h-10 object-cover rounded shadow-sm",
  zoomable = false 
}) => {
  const [isModalOpen, setIsModalOpen] = useState(false);

  if (!src) {
    return (
      <div className={`${className} bg-gray-100 flex items-center justify-center text-[10px] text-gray-400`}>
        –ù–ï–¢ –§–û–¢–û
      </div>
    );
  }

  return (
    <>
      {/* –ú–∏–Ω–∏–∞—Ç—é—Ä–∞ */}
      <img
        src={src}
        alt={alt}
        className={`${className} ${zoomable ? 'cursor-pointer hover:opacity-80 transition-opacity' : ''}`}
        onClick={() => zoomable && setIsModalOpen(true)}
      />

      {/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ (Lightbox) */}
      {zoomable && isModalOpen && (
        <div 
          className="fixed inset-0 z-[100] flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200"
          onClick={() => setIsModalOpen(false)}
        >
          <div className="relative max-w-4xl max-h-[90vh]">
            {/* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è */}
            <button 
              className="absolute -top-10 right-0 text-white text-3xl hover:text-gray-300"
              onClick={() => setIsModalOpen(false)}
            >
              &times;
            </button>
            
            <img
              src={src}
              alt={alt}
              className="max-w-full max-h-[85vh] rounded-lg shadow-2xl object-contain bg-white"
              onClick={(e) => e.stopPropagation()} // –ß—Ç–æ–±—ã –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–ª–æ—Å—å –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å–∞–º—É –∫–∞—Ä—Ç–∏–Ω–∫—É
            />
            
            {alt && (
              <p className="text-white text-center mt-4 font-medium text-lg italic">
                {alt}
              </p>
            )}
          </div>
        </div>
      )}
    </>
  );
};
--- FILE END: src\Components\UI\CakeImage.jsx ---

--- FILE START: src\Components\UI\index.js ---
export * from './CakeImage';
--- FILE END: src\Components\UI\index.js ---

--- FILE START: src\Controller\index.js ---
export * from './useController';
--- FILE END: src\Controller\index.js ---

--- FILE START: src\Controller\useController.js ---
import { useState, useCallback } from 'react';

export const useController = (model) => {
  const [data, setData] = useState([]);
  const [record, setRecord] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  // –ê–Ω–∞–ª–æ–≥ index() –≤ CakePHP - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞
  const getList = useCallback(async (options = {}) => {
    setLoading(true);
    setError(null);
    try {
      const result = await model.find(options);
      setData(result);
      return result;
    } catch (err) {
      setError(err.message);
      console.error(`[üéÇ CakeReact -> useController]: Error in getList:`, err);
    } finally {
      setLoading(false);
    }
  }, [model]);

  // –ê–Ω–∞–ª–æ–≥ view() –≤ CakePHP - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏
  const getRecord = useCallback(async (id) => {
    setLoading(true);
    setError(null);
    try {
      const result = await model.findById(id);
      setRecord(result);
      return result;
    } catch (err) {
      setError(err.message);
      console.error(`[üéÇ CakeReact -> useController]: Error in getRecord:`, err);
    } finally {
      setLoading(false);
    }
  }, [model]);

  /** DELETE!
   * // –ê–Ω–∞–ª–æ–≥ save() –≤ CakePHP (—Å–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
  const save = async (formData) => {
    setLoading(true);
    setError(null);
    try {
      const result = await model.save(formData);
      // –ï—Å–ª–∏ –º—ã –æ–±–Ω–æ–≤–ª—è–ª–∏ –∑–∞–ø–∏—Å—å –≤ —Å–ø–∏—Å–∫–µ, –ø–æ–¥–º–µ–Ω—è–µ–º –µ—ë
      setData(prev => {
        const index = prev.findIndex(item => item[model.primaryKey] === result[model.primaryKey]);
        if (index !== -1) {
          const newData = [...prev];
          newData[index] = result;
          return newData;
        }
        return [result, ...prev]; // –ï—Å–ª–∏ –Ω–æ–≤–∞—è ‚Äî –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
      });
      return { success: true, data: result };
    } catch (err) {
      setError(err.message);
      return { success: false, error: err.message };
    } finally {
      setLoading(false);
    }
  };
  */

  // –ê–Ω–∞–ª–æ–≥ save() –≤ CakePHP (—Å–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
  const save = async (formData) => {
    setLoading(true);
    setError(null);
    try {
      const result = await model.save(formData);

      // –î–û–ë–ê–í–õ–ï–ù–ê –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±—ã–ª–æ –æ—Ç–º–µ–Ω–µ–Ω–æ (–≤–∞–ª–∏–¥–∞—Ü–∏—è –∏–ª–∏ beforeSave)
      if (result === false) {
        // –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ false, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ª–æ–≥–∏–∫–∏
        return { success: false, error: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ –ø–ª–∞–≥–∏–Ω–æ–º –∏–ª–∏ —Ö—É–∫–æ–º.' };
      }

      // –ï—Å–ª–∏ –º—ã –æ–±–Ω–æ–≤–ª—è–ª–∏ –∑–∞–ø–∏—Å—å –≤ —Å–ø–∏—Å–∫–µ, –ø–æ–¥–º–µ–Ω—è–µ–º –µ—ë
      setData(prev => {
        // –ó–¥–µ—Å—å result —É–∂–µ —Ç–æ—á–Ω–æ –æ–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏
        const index = prev.findIndex(item => item[model.primaryKey] === result[model.primaryKey]);

        // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–µ–π—Ç–∞ ...
        if (index !== -1) {
          const newData = [...prev];
          newData[index] = result;
          return newData;
        }
        return [result, ...prev];
      });
      return { success: true, data: result };
    } catch (err) {
      setError(err.message);
      // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–∏—á–∏–Ω—É (Supabase error –∏ —Ç.–¥.)
      console.error("[CakeReact Controller Error]", err);
      return { success: false, error: err.message };
    } finally {
      setLoading(false);
    }
  };

  // –ê–Ω–∞–ª–æ–≥ delete() –≤ CakePHP
  const remove = async (id) => {
    setLoading(true);
    setError(null);
    try {
      await model.delete(id);
      setData(prev => prev.filter(item => item[model.primaryKey] !== id));
      return { success: true };
    } catch (err) {
      setError(err.message);
      return { success: false, error: err.message };
    } finally {
      setLoading(false);
    }
  };

  return {
    data,
    record,
    loading,
    error,
    getList,
    getRecord,
    save,
    remove,
    setRecord // –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è —Å–±—Ä–æ—Å–∞ —Ñ–æ—Ä–º—ã
  };
};
--- FILE END: src\Controller\useController.js ---

--- FILE START: src\index.js ---
export { CakeReact } from './CakeReactCore';
// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤—Å—ë –æ—Å–Ω–æ–≤–Ω–æ–µ –æ—Ç—Å—é–¥–∞, —á—Ç–æ–±—ã –±—ã–ª–æ —É–¥–æ–±–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
export * from './Model';
export * from './Utils';
export * from './Controller';
export * from './Components';
export * from './Storage';
--- FILE END: src\index.js ---

--- FILE START: src\Model\Adapters\BaseAdapter.js ---
export class BaseAdapter {
    constructor(client) {
        this.client = client;
    }

    // –≠—Ç–∏ –º–µ—Ç–æ–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–ª–∞—Å—Å–∞—Ö
    async find(table, options) { throw new Error('Method find() not implemented'); }
    async findById(table, id, primaryKey) { throw new Error('Method findById() not implemented'); }
    async create(table, data) { throw new Error('Method create() not implemented'); }
    async update(table, data, primaryKey) { throw new Error('Method update() not implemented'); }
    async delete(table, id, primaryKey) { throw new Error('Method delete() not implemented'); }
}
--- FILE END: src\Model\Adapters\BaseAdapter.js ---

--- FILE START: src\Model\Adapters\index.js ---
export * from './BaseAdapter';
export * from './SupabaseAdapter';
--- FILE END: src\Model\Adapters\index.js ---

--- FILE START: src\Model\Adapters\SupabaseAdapter.js ---
// src/Model/Adapters/SupabaseAdapter.js
import { BaseAdapter } from './BaseAdapter';

export class SupabaseAdapter extends BaseAdapter {
    /**
     * –ü–æ–∏—Å–∫ –ø–æ ID - –ø—Ä—è–º–æ–π –∏ –±—ã—Å—Ç—Ä—ã–π
     */
    async findById(table, id, primaryKey = 'id', options = {}) {
        const selectFields = this._buildSelectQuery(options.contain);

        const { data, error } = await this.client
            .from(table)
            .select(selectFields)
            .eq(primaryKey, id)
            .single(); // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±—ä–µ–∫—Ç, –∞ –Ω–µ –º–∞—Å—Å–∏–≤

        if (error && error.code !== 'PGRST116') throw error; // PGRST116 - –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
        return data;
    }

    async find(table, options = {}) {
        const selectFields = this._buildSelectQuery(options.contain);
        let query = this.client.from(table).select(selectFields);

        // –£—Å–ª–æ–≤–∏—è
        if (options.conditions) {
            Object.entries(options.conditions).forEach(([column, value]) => {
                if (value === null) query = query.is(column, null);
                else if (Array.isArray(value)) query = query.in(column, value);
                else query = query.eq(column, value);
            });
        }

        // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
        if (options.order) {
            query = query.order(options.order[0], { ascending: options.order[1]?.toLowerCase() === 'asc' });
        }

        // –õ–∏–º–∏—Ç
        if (options.limit) query = query.limit(options.limit);

        const { data, error } = await query;
        if (error) throw error;
        return data;
    }

    /**
     * –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫—É –≤—ã–±–æ—Ä–∫–∏ –ø–æ–ª–µ–π, –≤–∫–ª—é—á–∞—è —Å–≤—è–∑–∏ (contain)
     * @param {Array|Object|null} contain 
     * @returns {string}
     */
    _buildSelectQuery(contain) {
        if (!contain || (Array.isArray(contain) && contain.length === 0)) {
            return '*';
        }

        // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–ª–∏ –º–∞—Å—Å–∏–≤ ['User', 'Comments']
        if (Array.isArray(contain)) {
            const related = contain.map(relation => `${relation}(*)`).join(', ');
            return `*, ${related}`;
        }

        // –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–ª–∏ —Å–ª–æ–∂–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è –≥–ª—É–±–æ–∫–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏: { User: ['Profile'], Comments: true }
        if (typeof contain === 'object') {
            const related = Object.entries(contain).map(([key, value]) => {
                const subFields = (typeof value === 'object') ? this._buildSelectQuery(value) : '*';
                return `${key}(${subFields})`;
            }).join(', ');
            return `*, ${related}`;
        }

        return '*';
    }

    async create(table, data) {
        const { data: result, error } = await this.client
            .from(table)
            .insert(data)
            .select()
            .single();
        if (error) throw error;
        return result;
    }

    async update(table, data, primaryKey) {
        const { data: result, error } = await this.client
            .from(table)
            .update(data)
            .eq(primaryKey, data[primaryKey])
            .select()
            .single();
        if (error) throw error;
        return result;
    }

    async delete(table, id, primaryKey) {
        const { error } = await this.client
            .from(table)
            .delete()
            .eq(primaryKey, id);
        if (error) throw error;
        return true;
    }
}
--- FILE END: src\Model\Adapters\SupabaseAdapter.js ---

--- FILE START: src\Model\BaseEntity.js ---
// src/Model/BaseEntity.js

export class BaseEntity {
    constructor(properties = {}, options = {}) {
        this._properties = properties;
        this._dirty = {}; // –•—Ä–∞–Ω–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è
        this._new = options.new !== false; // –ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å –∏–ª–∏ –∏–∑ –ë–î?
        this._model = options.source || null; // –°—Å—ã–ª–∫–∞ –Ω–∞ –º–æ–¥–µ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º Proxy –¥–ª—è –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ –æ–±—Ä–∞—â–µ–Ω–∏–π entity.prop
        return new Proxy(this, {
            get: (target, prop, receiver) => {
                // 1. –ï—Å–ª–∏ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —Å–ª—É–∂–µ–±–Ω—ã–º –ø–æ–ª—è–º (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å _) –∏–ª–∏ –º–µ—Ç–æ–¥–∞–º –∫–ª–∞—Å—Å–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞–ø—Ä—è–º—É—é
                if (typeof prop === 'string' && (prop.startsWith('_') || typeof target[prop] === 'function')) {
                    return Reflect.get(target, prop, receiver);
                }

                // 2. –ò–Ω–∞—á–µ –∏–¥–µ–º —á–µ—Ä–µ–∑ –Ω–∞—à—É –ª–æ–≥–∏–∫—É –≥–µ—Ç—Ç–µ—Ä–æ–≤
                return target.get(prop);
            },

            set: (target, prop, value, receiver) => {
                // 1. –ï—Å–ª–∏ —ç—Ç–æ —Å–ª—É–∂–µ–±–Ω–æ–µ –ø–æ–ª–µ ‚Äî –ø–∏—à–µ–º –Ω–∞–ø—Ä—è–º—É—é
                if (typeof prop === 'string' && prop.startsWith('_')) {
                    return Reflect.set(target, prop, value, receiver);
                }

                // 2. –ò–Ω–∞—á–µ —á–µ—Ä–µ–∑ –Ω–∞—à—É –ª–æ–≥–∏–∫—É —Å–µ—Ç—Ç–µ—Ä–æ–≤
                target.set(prop, value);
                return true;
            },

            // –ß—Ç–æ–±—ã Object.keys(entity) –≤–æ–∑–≤—Ä–∞—â–∞–ª —Å–≤–æ–π—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞
            ownKeys: (target) => {
                // –°–æ–±–∏—Ä–∞–µ–º –∫–ª—é—á–∏ –∏–∑ —Å–≤–æ–π—Å—Ç–≤ –∏ dirty
                return [...new Set([...Object.keys(target._properties), ...Object.keys(target._dirty)])];
            },

            getOwnPropertyDescriptor: (target, prop) => {
                return {
                    enumerable: true,
                    configurable: true,
                    value: target.get(prop) // –í–∞–∂–Ω–æ! –ß—Ç–æ–±—ã JSON.stringify –±—Ä–∞–ª –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≥–µ—Ç—Ç–µ—Ä
                };
            }
        });
    }

    /**
     * –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å–≤–æ–π—Å—Ç–≤–∞
     */
    get(field) {
        // 1. –ò—â–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –≥–µ—Ç—Ç–µ—Ä: _getFieldName (CamelCase)
        // full_name -> _getFullName
        const pascalCase = this._toPascalCase(field);
        const getterName = `_get${pascalCase}`;

        if (typeof this[getterName] === 'function') {
            // –ü–µ—Ä–µ–¥–∞–µ–º —Å—ã—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å) –≤ –≥–µ—Ç—Ç–µ—Ä
            return this[getterName](this._properties[field]);
        }

        // 2. –ï—Å–ª–∏ –ø–æ–ª–µ –µ—Å—Ç—å –≤ _dirty, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ–≥–æ
        if (field in this._dirty) {
            return this._dirty[field];
        }

        // 3. –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        return this._properties[field];
    }

    /**
     * –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è
     */
    set(field, value) {
        // 1. –ò—â–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π —Å–µ—Ç—Ç–µ—Ä: _setFieldName
        const pascalCase = this._toPascalCase(field);
        const setterName = `_set${pascalCase}`;

        if (typeof this[setterName] === 'function') {
            value = this[setterName](value);
        }

        // 2. –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å —Ç–µ–∫—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º (—á—Ç–æ–±—ã –Ω–µ –ø–æ–º–µ—á–∞—Ç—å dirty –∑—Ä—è)
        // –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –±–µ—Ä–µ–º –∏–∑ _dirty –∏–ª–∏ _properties
        const currentValue = (field in this._dirty) ? this._dirty[field] : this._properties[field];

        if (currentValue !== value) {
            this._dirty[field] = value;
        }

        return this;
    }

    /**
     * –ü—Ä–æ–≤–µ—Ä–∫–∞, –±—ã–ª–æ –ª–∏ –ø–æ–ª–µ –∏–∑–º–µ–Ω–µ–Ω–æ
     */
    isDirty(field) {
        if (field) {
            return Object.prototype.hasOwnProperty.call(this._dirty, field);
        }
        return Object.keys(this._dirty).length > 0;
    }

    isNew() {
        return this._new;
    }

    /**
     * –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è dirty (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è)
     */
    clean() {
        // –ü–µ—Ä–µ–Ω–æ—Å–∏–º dirty –≤ properties
        Object.assign(this._properties, this._dirty);
        this._dirty = {};
        this._new = false;
        return this;
    }

    /**
     * –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —á–∏—Å—Ç—ã–π JSON
     */
    toArray() {
        const result = { ...this._properties };

        // –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ–º dirty –ø–æ–≤–µ—Ä—Ö
        Object.assign(result, this._dirty);

        // TODO: –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è virtual fields, –µ—Å–ª–∏ –º—ã —Ö–æ—Ç–∏–º –∏—Ö –≤ JSON
        // –ù–æ –ø–æ–∫–∞ –æ—Å—Ç–∞–≤–∏–º —Ç–æ–ª—å–∫–æ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        return result;
    }

    // –î–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å JSON.stringify(entity)
    toJSON() {
        return this.toArray();
    }

    // –•–µ–ª–ø–µ—Ä: snake_case -> PascalCase (user_id -> UserId, full_name -> FullName)
    _toPascalCase(string) {
        if (!string) return '';
        return string
            .replace(/^_+/, '') // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è –≤ –Ω–∞—á–∞–ª–µ, –µ—Å–ª–∏ –µ—Å—Ç—å
            .replace(/_(\w)/g, (match, letter) => letter.toUpperCase()) // snake_case -> camelCase
            .replace(/^\w/, c => c.toUpperCase()); // camelCase -> PascalCase
    }
}
--- FILE END: src\Model\BaseEntity.js ---

--- FILE START: src\Model\BaseModel.js ---
// src/Model/BaseModel.js
import { CakeReact } from '../CakeReactCore';
import { Validator } from './Validation/Validator';
import { BaseEntity } from './BaseEntity';

export class BaseModel {
  constructor(table, config = {}) {
    this.table = table;
    this.primaryKey = config.primaryKey || 'id';
    this.displayField = config.displayField || 'name';
    this.connectionName = config.connection || 'default';

    this.belongsTo = config.belongsTo || {};
    this.hasMany = config.hasMany || {};
    this.belongsToMany = config.belongsToMany || {};

    this._validator = null;
  }

  get adapter() {
    return CakeReact.getAdapter(this.connectionName);
  }

  /** Validation */
  get validator() {
    if (!this._validator) {
      this._validator = new Validator();
      this.validationDefault(this._validator);
    }
    return this._validator;
  }

  validationDefault(validator) {
    return validator;
  }

  /** Find Methods */
  async find(type = 'all', options = {}) {
    if (typeof type === 'object') {
      options = type;
      type = 'all';
    }

    const queryOptions = {
      conditions: {},
      contain: null,
      order: null,
      limit: type === 'first' ? 1 : null,
      ...options
    };

    const result = await this.adapter.find(this.table, queryOptions);

    if (type === 'first') {
      return result && result.length > 0 ? this._normalizeRow(result[0]) : null;
    }

    return this._normalizeResults(result);
  }

  async findById(id, options = {}) {
    const result = await this.adapter.findById(this.table, id, this.primaryKey, options);
    return result ? this._normalizeRow(result) : null;
  }

  /** Save & Delete */
  async save(entity) {
    const isNew = entity instanceof BaseEntity ? entity.isNew() : !entity[this.primaryKey];
    const eventName = isNew ? 'Model.beforeSave' : 'Model.beforeUpdate';

    const event = { name: eventName, subject: this, entity, stopped: false };
    await CakeReact.emit(eventName, event);
    if (event.stopped) return false;

    const data = entity instanceof BaseEntity ? entity.toArray() : entity;

    let result;
    if (isNew) {
      result = await this.adapter.create(this.table, data);
      if (entity instanceof BaseEntity && result) {
        entity._properties = { ...result };
        entity.clean();
      }
    } else {
      result = await this.adapter.update(this.table, data, this.primaryKey);
      if (entity instanceof BaseEntity) entity.clean();
    }

    await CakeReact.emit(isNew ? 'Model.afterSave' : 'Model.afterUpdate', { subject: this, entity });
    return entity;
  }

  async delete(id) {
    const event = { name: 'Model.beforeDelete', subject: this, id, stopped: false };
    if (this.beforeDelete && (await this.beforeDelete(id)) === false) return false;

    await CakeReact.emit('Model.beforeDelete', event);
    if (event.stopped) return false;

    const result = await this.adapter.delete(this.table, id, this.primaryKey);
    await CakeReact.emit('Model.afterDelete', { subject: this, id });
    return result;
  }

  /** Internal Helpers (–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!) */

  _normalizeResults(data) {
    if (!data || !Array.isArray(data)) return [];
    return data.map(row => this._normalizeRow(row));
  }

  _normalizeRow(row) {
    return this.createEntity(row, { new: false });
  }

  createEntity(data = {}, options = {}) {
    return new BaseEntity(data, { source: this, ...options });
  }

  /**
   * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π
   */
  _getRelations() {
    return {
      belongsTo: this.belongsTo,
      hasMany: this.hasMany,
      belongsToMany: this.belongsToMany
    };
  }
}
--- FILE END: src\Model\BaseModel.js ---

--- FILE START: src\Model\Behaviors\index.js ---
export * from './UploadImageBehavior';
--- FILE END: src\Model\Behaviors\index.js ---

--- FILE START: src\Model\Behaviors\UploadImageBehavior.js ---
// src/cakereact/src/Model/Behaviors/UploadImageBehavior.js
// TODO: –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å, –∏—Å–ø–æ–ª—å–∑—É—è Storage –∞–¥–∞–ø—Ç–µ—Ä—ã - —ç—Ç–æ—Ç behavior –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º: –ª–∏–±–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å –ø–æ–º–æ—â—å—é —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —è–≤–Ω–æ –∞–¥–∞–ø—Ç–µ—Ä–∞, –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–¥–∞–ø—Ç–µ—Ä –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é default
import { CakeReact } from '../../index';

export class UploadImageBehavior {
  /**
   * @param {Object} config - { db_field: { folder: '...', transformers: [...] } }
   * @param {string} bucket - –ë–∞–∫–µ—Ç –≤ Supabase
   */
  constructor(config = {}, bucket = 'images') {
    this.fieldConfig = config;
    this.bucket = bucket;
  }

  get db() {
    return CakeReact.getService(); //
  }

  /**
   * –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∑–æ–∫ –¥–ª—è –º–æ–¥–µ–ª–∏
   * @param {Object} data - –î–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã (–≤–∫–ª—é—á–∞—è —Ñ–∞–π–ª—ã)
   * @param {Object} model - –≠–∫–∑–µ–º–ø–ª—è—Ä –º–æ–¥–µ–ª–∏ (–¥–ª—è –ø–æ–∏—Å–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
   */
  async processUploads(data, model) {
    // 1. –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ä—É—é –∑–∞–ø–∏—Å—å –æ–¥–∏–Ω —Ä–∞–∑, –µ—Å–ª–∏ —ç—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    let oldRecord = null;
    if (data[model.primaryKey]) {
      try {
        oldRecord = await model.findById(data[model.primaryKey]);
      } catch (e) {
        console.warn("[üéÇ CakeReact -> UploadImageBehavior]: –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å—Ç–∞—Ä—É—é –∑–∞–ø–∏—Å—å –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤", e);
      }
    }

    for (const [field, settings] of Object.entries(this.fieldConfig)) {
      let file = data[field];

      if (file instanceof File) {
        // --- –¶–ï–ü–û–ß–ö–ê –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–Ø ---
        // –ï—Å–ª–∏ —É –ø–æ–ª—è –µ—Å—Ç—å —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–µ—Ä—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è), –ø—Ä–æ–≥–æ–Ω—è–µ–º —Ñ–∞–π–ª —á–µ—Ä–µ–∑ –Ω–∏—Ö
        if (settings.transformers && Array.isArray(settings.transformers)) {
          for (const transform of settings.transformers) {
            file = await transform(file);
          }
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
        // 2. –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—É—é oldRecord
        if (oldRecord && oldRecord[field]) {
          // –í–∞–∂–Ω–æ: –ø—Ä–æ–≤–µ—Ä—è–µ–º, –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ —Ñ–∞–π–ª. –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π - –Ω–µ —É–¥–∞–ª—è–µ–º.
          // –•–æ—Ç—è input type="file" –æ–±—ã—á–Ω–æ –Ω–µ –¥–∞–µ—Ç –≤—ã–±—Ä–∞—Ç—å "—Ç–µ–∫—É—â–∏–π URL", –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –ø–æ–º–µ—à–∞–µ—Ç.
          if (oldRecord[field] !== file) {
            await this.deleteFile(oldRecord[field]);
          }
        }

        const publicUrl = await this.upload(file, settings.folder);
        data[field] = publicUrl;
      }
    }
    return data;
  }

  async upload(file, folder) {
    const fileExt = file.name.split('.').pop();
    const fileName = `${Math.random().toString(36).substring(2)}-${Date.now()}.${fileExt}`;
    const filePath = folder ? `${folder}/${fileName}` : fileName;

    const { error } = await this.db.storage
      .from(this.bucket)
      .upload(filePath, file);

    if (error) throw error;

    const { data: { publicUrl } } = this.db.storage
      .from(this.bucket)
      .getPublicUrl(filePath);

    return publicUrl;
  }

  async deleteFile(url) {
    if (!url || typeof url !== 'string') return;
    try {
      // 1. –£–±–∏—Ä–∞–µ–º –≤—Å—ë, —á—Ç–æ –∏–¥–µ—Ç –ø–æ—Å–ª–µ –∑–Ω–∞–∫–∞ –≤–æ–ø—Ä–æ—Å–∞ (query params) –∏–ª–∏ —Ä–µ—à–µ—Ç–∫–∏
      // –ù–∞–ø—Ä–∏–º–µ—Ä: image.jpg?t=123 -> image.jpg
      const cleanUrl = url.split('?')[0].split('#')[0];

      // 2. –†–∞–∑–±–∏–≤–∞–µ–º –ø–æ –∏–º–µ–Ω–∏ –±–∞–∫–µ—Ç–∞
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º `${this.bucket}/` –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
      const pathParts = cleanUrl.split(`${this.bucket}/`);

      // –ï—Å–ª–∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ —ç—Ç–æ –Ω–µ —Ç–∞ —Å—Å—ã–ª–∫–∞, –≤—ã—Ö–æ–¥–∏–º
      if (pathParts.length < 2) {
        console.warn(`[üéÇ CakeReact -> UploadImageBehavior]: –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å URL –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: ${url}`);
        return;
      }

      // 3. –ë–µ—Ä–µ–º —á–∞—Å—Ç—å –ø—É—Ç–∏ –ø–æ—Å–ª–µ –±–∞–∫–µ—Ç–∞
      // –í–ê–ñ–ù–û: –î–µ–∫–æ–¥–∏—Ä—É–µ–º URI (–ø—Ä–µ–≤—Ä–∞—â–∞–µ–º %20 –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—Ä–æ–±–µ–ª—ã, —Ä—É—Å—Å–∫–∏–µ –±—É–∫–≤—ã –∏ —Ç.–¥.)
      const rawPath = pathParts.slice(1).join(`${this.bucket}/`); // join –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –∏–º—è –±–∞–∫–µ—Ç–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ –ø—É—Ç–∏ –¥–≤–∞–∂–¥—ã (—Ä–µ–¥–∫–æ, –Ω–æ –±—ã–≤–∞–µ—Ç)
      const filePath = decodeURIComponent(rawPath);

      console.log(`[üéÇ CakeReact -> UploadImageBehavior]: –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª: ${filePath}`);

      const { error } = await this.db.storage
        .from(this.bucket)
        .remove([filePath]);

      if (error) throw error;

    } catch (e) {
      console.warn("[üéÇ CakeReact -> UploadImageBehavior]: –§–∞–π–ª –Ω–µ —É–¥–∞–ª–µ–Ω –∏–∑ storage:", e);
    }
  }

  /**
   * –ú–µ—Ç–æ–¥ –¥–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –µ—ë —É–¥–∞–ª–µ–Ω–∏–∏
   */
  async deleteAllFiles(record) {
    for (const field of Object.keys(this.fieldConfig)) {
      if (record[field]) {
        await this.deleteFile(record[field]);
        console.log(`[üéÇ CakeReact -> UploadImageBehavior]: –£–¥–∞–ª—è–µ–º —Ñ–∞–π–ª –¥–ª—è –ø–æ–ª—è: ${record[field]}`);
      }
    }
  }
}
--- FILE END: src\Model\Behaviors\UploadImageBehavior.js ---

--- FILE START: src\Model\index.js ---
export * from './BaseModel';
export * from './BaseEntity';
export * from './Behaviors';
export * from './Validation';
export * from './Adapters';

--- FILE END: src\Model\index.js ---

--- FILE START: src\Model\Validation\index.js ---
export * from './ValidationRules';
export * from './Validator';
--- FILE END: src\Model\Validation\index.js ---

--- FILE START: src\Model\Validation\ValidationRules.js ---
export const ValidationRules = {
    notEmpty: (value) => value !== undefined && value !== null && String(value).trim() !== '',
    email: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
    minLength: (value, min) => String(value).length >= min,
    maxLength: (value, max) => String(value).length <= max,
    numeric: (value) => !isNaN(parseFloat(value)) && isFinite(value),
    // –¢–≤–æ–π —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –≤–∞–ª–∏–¥–∞—Ç–æ—Ä —à—Ç—Ä–∏—Ö–∫–æ–¥–æ–≤ (EAN-13 –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
    barcode: (value) => /^\d{8,14}$/.test(value),
    custom: (value, fn) => fn(value),
};
--- FILE END: src\Model\Validation\ValidationRules.js ---

--- FILE START: src\Model\Validation\Validator.js ---
import { ValidationRules } from "../../index";

export class Validator {
    constructor() {
        this._rules = {}; // { field: [ { rule, message, params }, ... ] }
    }

    add(field, ruleName, options = {}) {
        if (!this._rules[field]) this._rules[field] = [];

        this._rules[field].push({
            rule: ruleName,
            message: options.message || `Invalid ${ruleName}`,
            params: options.params || null,
            last: options.last || false // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–ª—è –Ω–∞ —ç—Ç–æ–π –æ—à–∏–±–∫–µ?
        });
        return this;
    }

    async validate(data) {
        const errors = {};

        for (const field in this._rules) {
            const fieldValue = data[field];
            const rules = this._rules[field];

            for (const ruleObj of rules) {
                const { rule, message, params, last } = ruleObj;
                let isValid = true;

                if (typeof rule === 'function') {
                    isValid = await rule(fieldValue, data);
                } else if (ValidationRules[rule]) {
                    isValid = ValidationRules[rule](fieldValue, params);
                }

                if (!isValid) {
                    if (!errors[field]) errors[field] = [];
                    errors[field].push(message);
                    if (last) break;
                }
            }
        }

        return Object.keys(errors).length === 0 ? true : errors;
    }
}
--- FILE END: src\Model\Validation\Validator.js ---

--- FILE START: src\Storage\BaseStorageAdapter.js ---
// src/Storage/BaseStorageAdapter.js
export class BaseStorageAdapter {
    constructor(client, bucket) {
        this.client = client;
        this.bucket = bucket;
    }

    // –ú–µ—Ç–æ–¥ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
    async upload(path, file) { throw new Error('upload() not implemented'); }

    // –ú–µ—Ç–æ–¥ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
    async delete(path) { throw new Error('delete() not implemented'); }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–∏
    async getUrl(path) { throw new Error('getUrl() not implemented'); }
}
--- FILE END: src\Storage\BaseStorageAdapter.js ---

--- FILE START: src\Storage\index.js ---
export * from './BaseStorageAdapter';
export * from './SupabaseStorageAdapter';
--- FILE END: src\Storage\index.js ---

--- FILE START: src\Storage\SupabaseStorageAdapter.js ---
// src/Storage/SupabaseStorageAdapter.js
import { BaseStorageAdapter } from './BaseStorageAdapter';

export class SupabaseStorageAdapter extends BaseStorageAdapter {
    async upload(path, file) {
        const { data, error } = await this.client.storage
            .from(this.bucket)
            .upload(path, file, { upsert: true });

        if (error) throw error;
        return data.path; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
    }

    async delete(path) {
        const { error } = await this.client.storage.from(this.bucket).remove([path]);
        if (error) throw error;
        return true;
    }

    async getUrl(path) {
        const { data } = this.client.storage.from(this.bucket).getPublicUrl(path);
        return data.publicUrl;
    }
}
--- FILE END: src\Storage\SupabaseStorageAdapter.js ---

--- FILE START: src\Utils\definePlugin.js ---
/**
 * –•–µ–ª–ø–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤ —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏.
 * @param {object} config - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞ { name, setup, ... }
 */
export const definePlugin = (config) => {
    if (!config.name) {
        console.warn('[üéÇ CakeReact]: Plugin must have a "name" property.');
    }
    return config;
};
--- FILE END: src\Utils\definePlugin.js ---

--- FILE START: src\Utils\ImageOptimizer.js ---
/**
 * –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Å–∂–∞—Ç–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Canvas API –¥–ª—è —Ä–µ—Å–∞–π–∑–∞ –∏ —Å–∂–∞—Ç–∏—è
 */
export const ImageOptimizer = {
  /**
   * –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ —Å–∂–∞—Ç–∏—è
   * @param {File} file - –ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª
   * @param {Object} options - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∂–∞—Ç–∏—è
   * @returns {Promise<File>} - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
   */
  async compress(file, options = {}) {
    // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    const settings = {
      maxWidth: 1200,      // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞
      maxHeight: 1200,     // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞
      quality: 0.8,        // –ö–∞—á–µ—Å—Ç–≤–æ JPEG/WEBP (0 to 1)
      mimeType: 'image/jpeg', // –í–æ —á—Ç–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å (–º–æ–∂–Ω–æ 'image/webp')
      ...options
    };

    // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –∫–∞—Ä—Ç–∏–Ω–∫–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
    if (!file.type.startsWith('image/')) return file;

    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.readAsDataURL(file);
      
      reader.onload = (event) => {
        const img = new Image();
        img.src = event.target.result;
        
        img.onload = () => {
          // 1. –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–µ —Ä–∞–∑–º–µ—Ä—ã, —Å–æ—Ö—Ä–∞–Ω—è—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏
          let width = img.width;
          let height = img.height;

          if (width > height) {
            if (width > settings.maxWidth) {
              height = Math.round((height * settings.maxWidth) / width);
              width = settings.maxWidth;
            }
          } else {
            if (height > settings.maxHeight) {
              width = Math.round((width * settings.maxHeight) / height);
              height = settings.maxHeight;
            }
          }

          // 2. –†–∏—Å—É–µ–º –Ω–∞ Canvas
          const canvas = document.createElement('canvas');
          canvas.width = width;
          canvas.height = height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(img, 0, 0, width, height);

          // 3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º Canvas –≤ Blob/File
          canvas.toBlob((blob) => {
            if (!blob) {
              reject(new Error('Image compression failed'));
              return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç File —Å —Ç–µ–º –∂–µ –∏–º–µ–Ω–µ–º, –Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º —Ç–∏–ø–æ–º –∏ —Ä–∞–∑–º–µ—Ä–æ–º
            const optimizedFile = new File([blob], file.name, {
              type: settings.mimeType,
              lastModified: Date.now(),
            });

            console.log(`[üéÇ CakeReact -> ImageOptimizer] –°–∂–∞—Ç–æ: ${(file.size / 1024).toFixed(0)}KB -> ${(optimizedFile.size / 1024).toFixed(0)}KB`);
            resolve(optimizedFile);

          }, settings.mimeType, settings.quality);
        };
        
        img.onerror = (err) => reject(err);
      };
      
      reader.onerror = (err) => reject(err);
    });
  }
};
--- FILE END: src\Utils\ImageOptimizer.js ---

--- FILE START: src\Utils\index.js ---
// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∏ —Ç—É—Ç –∂–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º
export * from './ImageOptimizer';
export * from './definePlugin';
--- FILE END: src\Utils\index.js ---

--- FILE START: tests\ai_guardrails\BaseEntity.integrity.test.js ---
import { describe, it, expect, vi } from 'vitest';
import { BaseEntity } from '../../src/Model/BaseEntity';

describe('AI Guardrail: BaseEntity Integrity', () => {

    it('üîí –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º', () => {
        const entity = new BaseEntity();
        const requiredMethods = [
            'get', 'set', 'isDirty', 'clean', 'isNew', 'toArray'
        ];

        requiredMethods.forEach(method => {
            expect(typeof entity[method]).toBe('function', `–ú–µ—Ç–æ–¥ ${method} –±—ã–ª —É–¥–∞–ª–µ–Ω –∏–∑ BaseEntity!`);
        });
    });

    it('üîí —Å–µ—Ç—Ç–µ—Ä—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å —á–µ—Ä–µ–∑ Proxy –∏ –ø–æ–º–µ—á–∞—Ç—å –ø–æ–ª–µ –∫–∞–∫ dirty', () => {
        const entity = new BaseEntity({ name: 'Old' });

        // –ü—Ä—è–º–æ–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç—å set()
        entity.name = 'New';

        expect(entity.get('name')).toBe('New');
        expect(entity.isDirty('name')).toBe(true);
    });

    it('üîí clean() –¥–æ–ª–∂–µ–Ω —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ dirty', () => {
        const entity = new BaseEntity({ name: 'Old' });
        entity.name = 'New';

        expect(entity.isDirty('name')).toBe(true);

        entity.clean();

        expect(entity.isDirty('name')).toBe(false);
        expect(entity.get('name')).toBe('New'); // –ó–Ω–∞—á–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è, –Ω–æ —Ñ–ª–∞–≥–∞ dirty –Ω–µ—Ç
    });

    it('üîí –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –º–æ–¥–µ–ª—å (source)', () => {
        const mockModel = { table: 'test' };
        const entity = new BaseEntity({}, { source: mockModel });

        // –≠—Ç–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ, –Ω–æ –æ–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è lazy loading –≤ –±—É–¥—É—â–µ–º
        expect(entity._model).toBe(mockModel);
    });
});
--- FILE END: tests\ai_guardrails\BaseEntity.integrity.test.js ---

--- FILE START: tests\ai_guardrails\BaseModel.integrity.test.js ---
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { BaseModel } from '../../src/Model/BaseModel';
import { CakeReact } from '../../src/CakeReactCore';

// –ú–æ–∫ –¥–ª—è –∞–¥–∞–ø—Ç–µ—Ä–∞, —á—Ç–æ–±—ã —Ç–µ—Å—Ç—ã –Ω–µ –ø–∞–¥–∞–ª–∏ –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ë–î
const mockAdapter = {
    find: vi.fn(() => Promise.resolve([])),
    findById: vi.fn(() => Promise.resolve(null)),
};

describe('AI Guardrail: BaseModel Integrity', () => {
    let model;

    beforeEach(() => {
        model = new BaseModel('posts');
        // –ü–æ–¥–º–µ–Ω—è–µ–º –∞–¥–∞–ø—Ç–µ—Ä
        vi.spyOn(CakeReact, 'getAdapter').mockReturnValue(mockAdapter);
    });

    it('–¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –í–°–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã (–∑–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è)', () => {
        const requiredMethods = [
            'find', 'findById', 'save', 'delete',
            '_normalizeResults', '_normalizeRow', '_getRelations',
            'validationDefault', 'createEntity'
        ];

        requiredMethods.forEach(method => {
            expect(typeof model[method]).toBe('function', `–ú–µ—Ç–æ–¥ ${method} –±—ã–ª —É–¥–∞–ª–µ–Ω!`);
        });
    });

    it('find() –¥–æ–ª–∂–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å _normalizeRow –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏', async () => {
        // –ü–æ–¥–∫–ª–∞–¥—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        mockAdapter.find.mockResolvedValueOnce([{ id: 1 }, { id: 2 }]);

        // –®–ø–∏–æ–Ω–∏–º –∑–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º –º–µ—Ç–æ–¥–æ–º
        const normalizeSpy = vi.spyOn(model, '_normalizeRow');

        await model.find('all');

        expect(normalizeSpy).toHaveBeenCalledTimes(2);
        expect(normalizeSpy).toHaveBeenCalledWith({ id: 1 });
    });

    it('save() –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è beforeSave –∏ afterSave', async () => {
        const emitSpy = vi.spyOn(CakeReact, 'emit');
        const entity = model.createEntity({ title: 'Test' });

        await model.save(entity);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–æ–±—ã—Ç–∏—è –±—ã–ª–∏ –≤—ã–∑–≤–∞–Ω—ã
        expect(emitSpy).toHaveBeenCalledWith('Model.beforeSave', expect.any(Object));
        expect(emitSpy).toHaveBeenCalledWith('Model.afterSave', expect.any(Object));
    });
});
--- FILE END: tests\ai_guardrails\BaseModel.integrity.test.js ---

--- FILE START: tests\ai_guardrails\SupabaseAdapter.integrity.test.js ---
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { SupabaseAdapter } from '../../src/Model/Adapters/SupabaseAdapter';

// –ú–æ–∫ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ Supabase
const mockSupabase = {
    from: vi.fn(() => queryBuilder),
};

const queryBuilder = {
    select: vi.fn().mockReturnThis(),
    eq: vi.fn().mockReturnThis(),
    order: vi.fn().mockReturnThis(),
    limit: vi.fn().mockReturnThis(),
    single: vi.fn().mockResolvedValue({ data: {}, error: null }), // –í–∞–∂–Ω–æ –¥–ª—è findById
    insert: vi.fn().mockReturnThis(),
    update: vi.fn().mockReturnThis(),
    delete: vi.fn().mockReturnThis(),
    then: (cb) => Promise.resolve({ data: [], error: null }).then(cb)
};

describe('AI Guardrail: SupabaseAdapter Integrity', () => {
    let adapter;

    beforeEach(() => {
        vi.clearAllMocks();
        adapter = new SupabaseAdapter(mockSupabase);
    });

    it('üîí –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –í–°–ï –º–µ—Ç–æ–¥—ã (Interface + Helpers)', () => {
        const requiredMethods = [
            'find',
            'findById',
            'create',
            'update',
            'delete',
            '_buildSelectQuery' // –Ø –Ω–µ –∏–º–µ—é –ø—Ä–∞–≤–∞ —É–¥–∞–ª—è—Ç—å —ç—Ç–æ—Ç —Ö–µ–ª–ø–µ—Ä!
        ];

        requiredMethods.forEach(method => {
            expect(typeof adapter[method]).toBe('function', `–ú–µ—Ç–æ–¥ ${method} –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ SupabaseAdapter!`);
        });
    });

    it('üîí find() –æ–±—è–∑–∞–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å _buildSelectQuery –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞', async () => {
        const spyBuild = vi.spyOn(adapter, '_buildSelectQuery');

        await adapter.find('users', { contain: ['Profile'] });

        expect(spyBuild).toHaveBeenCalled();
        expect(queryBuilder.select).toHaveBeenCalled();
    });

    it('üîí findById() –æ–±—è–∑–∞–Ω –≤—ã–∑—ã–≤–∞—Ç—å .single() –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏', async () => {
        await adapter.findById('users', 1);
        expect(queryBuilder.single).toHaveBeenCalled();
    });
});
--- FILE END: tests\ai_guardrails\SupabaseAdapter.integrity.test.js ---

--- FILE START: tests\integration\BaseModelSupabaseAdapter.test.js ---
// tests/integration/ModelAdapter.test.js
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { CakeReact } from '../../src/CakeReactCore';
import { BaseModel } from '../../src/Model/BaseModel';
import { SupabaseAdapter } from '../../src/Model/Adapters/SupabaseAdapter';
import { MockSupabaseClient } from '../mocks/MockSupabase';

// –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
const MOCK_DATA = {
    products: [
        { id: 1, name: 'Cake', price: 100 },
        { id: 2, name: 'Cookie', price: 50 }
    ]
};

describe('CakeReact Core: Model & Adapter Integration', () => {
    let mockClient;

    beforeEach(() => {
        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–µ–π–∫–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
        mockClient = new MockSupabaseClient(MOCK_DATA);

        // 2. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ CakeReact
        // –í–∞–∂–Ω–æ: –º—ã –ø–µ—Ä–µ–¥–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å SupabaseAdapter, –Ω–æ —Å–∫–∞—Ä–º–ª–∏–≤–∞–µ–º –µ–º—É —Ñ–µ–π–∫–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
        CakeReact.addConnection('default', {
            client: mockClient,
            adapter: SupabaseAdapter
        });
    });

    it('find() –¥–æ–ª–∂–µ–Ω —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ Supabase', async () => {
        const model = new BaseModel('products');

        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º, —á—Ç–æ –¥–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å –±–∞–∑–∞
        mockClient.__setNextResponse([{ id: 1, name: 'Cake', price: 100 }]);

        const results = await model.find({
            conditions: { price: 100 },
            limit: 1
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤–µ—Ä–Ω—É–ª–∏—Å—å –¥–∞–Ω–Ω—ã–µ
        expect(results).toHaveLength(1);
        expect(results[0].name).toBe('Cake');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å —É—à–µ–ª –≤ "–±–∞–∑—É"
        expect(mockClient.lastQuery.table).toBe('products');
        expect(mockClient.lastQuery.filters).toContainEqual({
            column: 'price', operator: 'eq', value: 100
        });
    });

    it('save() –¥–æ–ª–∂–µ–Ω –≤—ã–∑—ã–≤–∞—Ç—å insert –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π', async () => {
        // TODO: –≠—Ç–æ—Ç —Ç–µ—Å—Ç —É–ø–∞–¥–µ—Ç, –ø–æ–∫–∞ –º—ã –Ω–µ –¥–æ–ø–∏—à–µ–º –º–µ—Ç–æ–¥ save() –∏ create() –≤ –∞–¥–∞–ø—Ç–µ—Ä–µ,
        // –Ω–æ —ç—Ç–æ –Ω–∞—à–∞ —Ü–µ–ª—å –Ω–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥!
    });
});
--- FILE END: tests\integration\BaseModelSupabaseAdapter.test.js ---

--- FILE START: tests\mocks\MockSupabase.js ---
// tests/mocks/MockSupabase.js

/**
 * –≠–º—É–ª—è—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ Supabase –¥–ª—è —Ç–µ—Å—Ç–æ–≤.
 * –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å, –∫–∞–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã —É—Ö–æ–¥—è—Ç, –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
 */
export class MockSupabaseClient {
    constructor(mockData = {}) {
        this.mockData = mockData;
        this.lastQuery = {};
        this.responseToReturn = { data: null, error: null };
    }

    __setNextResponse(data, error = null) {
        this.responseToReturn = { data, error };
    }

    from(table) {
        this.lastQuery.table = table;
        this.lastQuery.filters = [];
        return new QueryBuilder(this, table);
    }
}

class QueryBuilder {
    constructor(client, table) {
        this.client = client;
        this.table = table;
    }

    select(columns = '*') {
        this.client.lastQuery.select = columns;
        return this; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º this –¥–ª—è —Ü–µ–ø–æ—á–∫–∏ –≤—ã–∑–æ–≤–æ–≤
    }

    eq(column, value) {
        this.client.lastQuery.filters.push({ column, operator: 'eq', value });
        return this;
    }

    in(column, values) {
        this.client.lastQuery.filters.push({ column, operator: 'in', value: values });
        return this;
    }

    order(column, { ascending = true } = {}) {
        this.client.lastQuery.order = { column, ascending };
        return this;
    }

    // –í–û–¢ –ß–ï–ì–û –ù–ï –•–í–ê–¢–ê–õ–û:
    limit(count) {
        this.client.lastQuery.limit = count;
        return this;
    }

    range(from, to) {
        this.client.lastQuery.range = { from, to };
        return this;
    }

    single() {
        this.client.lastQuery.single = true;
        return this;
    }

    // –§–∏–Ω–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
    then(callback) {
        const response = this.client.responseToReturn;

        // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ –∑–∞–¥–∞–Ω –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ, –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –≤ mockData
        if (!response.data && !response.error && this.client.mockData[this.table]) {
            let data = [...this.client.mockData[this.table]];
            // –¢—É—Ç –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Å—Ç—É—é –ª–æ–≥–∏–∫—É —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
            response.data = data;
        }

        return new Promise(resolve => resolve(response)).then(callback);
    }
}
--- FILE END: tests\mocks\MockSupabase.js ---

--- FILE START: tests\unit\BaseEntity.test.js ---
// tests/unit/BaseEntity.test.js
import { describe, it, expect } from 'vitest';
import { BaseEntity } from '../../src/Model/BaseEntity';

// 1. –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∞—Å—Å, –Ω–∞—Å–ª–µ–¥—É–µ–º—ã–π –æ—Ç BaseEntity
class User extends BaseEntity {
    // –ú–∞–≥–∏—á–µ—Å–∫–∏–π –≥–µ—Ç—Ç–µ—Ä
    _getFullName() {
        return `${this._properties.first_name} ${this._properties.last_name}`;
    }

    // –ú–∞–≥–∏—á–µ—Å–∫–∏–π —Å–µ—Ç—Ç–µ—Ä
    _setEmail(value) {
        return value.toLowerCase().trim();
    }
}

describe('CakeReact Core: BaseEntity', () => {

    it('–¥–æ–ª–∂–µ–Ω –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å –¥–∞–Ω–Ω—ã–º–∏', () => {
        const user = new User({ id: 1, first_name: 'John' });
        expect(user.id).toBe(1);
        expect(user.first_name).toBe('John');
    });

    it('–¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–µ –≥–µ—Ç—Ç–µ—Ä—ã (Virtual Fields)', () => {
        const user = new User({ first_name: 'John', last_name: 'Doe' });
        expect(user.full_name).toBe('John Doe'); // –ü—Ä–æ–≤–µ—Ä–∫–∞ snake_case –¥–æ—Å—Ç—É–ø–∞ –∫ _getCamelCase
    });

    it('–¥–æ–ª–∂–µ–Ω –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –≥—Ä—è–∑–Ω—ã–µ –ø–æ–ª—è (Dirty Checking)', () => {
        const user = new User({ id: 1, name: 'Old Name' }, { new: false });

        // –°–Ω–∞—á–∞–ª–∞ —á–∏—Å—Ç–æ
        expect(user.isDirty('name')).toBe(false);

        // –ú–µ–Ω—è–µ–º
        user.name = 'New Name';

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –≥–µ—Ç—Ç–µ—Ä
        expect(user.name).toBe('New Name');

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–ª–∞–≥ (–æ–Ω –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å true)
        expect(user.isDirty('name')).toBe(true);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–æ–Ω–æ –¥–æ–ª–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –°–ê–ú–û –ó–ù–ê–ß–ï–ù–ò–ï)
        expect(user._dirty['name']).toBe('New Name');
    });

    it('–¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏–µ —Å–µ—Ç—Ç–µ—Ä—ã', () => {
        const user = new User({});
        user.email = '  TEST@Example.com  ';

        expect(user.email).toBe('test@example.com');
        expect(user.isDirty('email')).toBe(true);
    });

    it('toArray() –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —á–∏—Å—Ç—ã–π –æ–±—ä–µ–∫—Ç', () => {
        const user = new User({ id: 1 });
        user.name = 'Test';

        const raw = user.toArray();
        expect(raw).toEqual({ id: 1, name: 'Test' });
        expect(raw).not.toBeInstanceOf(BaseEntity);
    });
});
--- FILE END: tests\unit\BaseEntity.test.js ---

--- FILE START: TRIBUTE.md ---
# Tribute to the Roots: Why this Engine exists

This project is not just a collection of scripts. It is a tribute to **CakePHP**, the framework that taught me the beauty of structured code and the power of MVC.

### The Inspiration
Back in the day, CakePHP was my gateway into the world of professional web development. It showed me that:
* **Databases are not scary** if you have a solid Model layer.
* **Architecture matters**: separating logic (Controllers) from presentation (Views) is the only way to build lasting projects.
* **Convention over Configuration**: standardizing the way we build things saves time and mental energy.

### The Aesthetics
I always admired the original 1960s style of the CakePHP website ‚Äî it had a soul and a unique character. While technology has moved from PHP to modern JavaScript and Supabase, the principles remain the same.

### The Purpose
This engine is my attempt to bring that "Bake" experience into the React/Supabase ecosystem. It is built for speed, consistency, and clean development. 

*Thank you, CakePHP team, for the inspiration and the lessons learned.*

## The Beauty of the Tag: Why React?

While CakePHP gave me the structure, **React** gave me the visual language I truly love. 

### Ode to HTML & XML
I have always been fascinated by the syntax of markup languages. There is a special kind of magic in how a simple `<tag>` can transform plain text into a living object ‚Äî a card, a button, or a complex dashboard. 

To me, HTML and XML are the most natural ways to describe the world. They turn the chaos of data into a clear, nested hierarchy.

### The React Connection
The moment I discovered React, I fell in love with its "HTML-ness". JSX is not just a syntax sugar for me; it's the fulfillment of a dream where logic and markup live in perfect harmony. 
* No other view engine could ever tempt me. 
* No other approach feels as intuitive as describing an interface with components that look like tags.

**CakeReact** is my attempt to take the solid, reliable architecture of the PHP past and dress it in the beautiful, declarative "HTML-style" clothes of the React present.

"The name is a direct bridge. It‚Äôs not a lack of imagination, but a clear statement of intent: bringing the structured heritage of the PHP era into the declarative beauty of the React world."
--- FILE END: TRIBUTE.md ---
